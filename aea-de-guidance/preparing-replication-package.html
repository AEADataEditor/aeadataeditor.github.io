


<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Preparing your code for computational verification - Office of the AEA Data Editor</title>
<meta name="description" content="The steps in this document are being used in a pilot project.   This document describes how to prepare your code for verification, taking into account some of the most frequent issues that the Data Editor and his team have encountered in submitted replication packages.     ⚠️❗ IMPORTANT: At this point, you should only be seeing this page if you were asked by the Data Editor team to do so, and if your replication package relies on a single software. Admissible containers are listed in the Step 5 section: authorized containers. We are not currently attempting to generalize this to multi-software replication packages, though it is possible to do so.   Overview  We will describe a few checks and edits you should make to your code, in order to ensure maximum reproducibility. We then describe how to test for reproducibility before submitting to the Data Editor. All steps have been tested by undergraduate replicators, and should be easy to implement. Whether they take a lot of time depends on your specific code, but generally, these adjustments can be made by somebody with good knowledge of the code base very quickly.  Much more extensive guidance on the issues addressed here is available at https://larsvilhuber.github.io/self-checking-reproducibility/. We reference specific chapters there at each of the steps.     ⚠️❗ IMPORTANT: All but the last steps can be done by anybody, no special system requirements required, and independent of your ability to share confidential data. However, the last step may not be possible in an institution that does not allow you to install container software (Docker, OrbStack, etc.), and does not have such technology installed on a Linux cluster. We provide a public website where you can leverage containers for verification, but you should not use it for confidential data. In that case, please do all the other steps.     Checklist  Print off (as PDF or on paper) the following checklist, and tick off each item as you complete it. Provide the completed checklist as part of the replication package.     Step 1: Main file: A single main file is provided that runs all code.   Step 2: Path names: All paths in code use / (forward slashes) relative to a single top-level project directory ($rootdir, $basedir, etc.). The top-level project directory is set dynamically, not hard-coded (explanations below).   Step 3: Dependencies: All packages/libraries/dependencies are installed via code once.            For Stata, these packages are installed into a subdirectory in the project ($rootdir/ado, $basedir/adofiles, etc.), and used by the code.       For R, renv is used (exceptions made for other package management systems if such a system is explained).       For Python, environments are used (native venv or conda), and the necessary top-level requirements specified (no OS-specific dependencies are included).           Step 4: Displays: All figures and tables are written out to clearly identified external files, and the authors’ versions, as used in the manuscript, are provided.   Step 5: Testing in containers: After all changes were made, the code was run            using an appropriate authorized container, and the generated log files are provided.       using the provided website, a certified ZIP file was created, and is provided instead of the original replication package.           (usually not necessary) Finalize: Update the README with the necessary information about computer specifications, Docker image used, memory and disk space requirements, and expected runtime.       Detailed instructions  Preliminary: Directory structure of a replication package  A generic replication package, housed at /my/computer/users/me/project, might have the following structure:  README.pdf data/    raw/       cps0001.dat    analysis/       combined_data.dta       combined_data.csv       combined_data_codebook.pdf code/   01_readcps.do   02_readfred.do   03_table1-5.do   04_figures1-4.do results/   table1.tex   table2.xlsx   ...   figure1.png   figure2.pdf   where     data/raw has the externally acquired raw data files (not modified by the authors)   data/analysis has the processed data files, generated by the code in this repository.   code has the code files.   results has all the results files.   For illustration purposes, we have used Stata .do files, and outputs in a variety of formats, but the same principles apply to other software, and to any output formats.     Note that we did not specify where the main.do file will be!   Short-cut     If you want to include the key code pieces for Stata that are needed to comply with Steps 1-3, you can use  this code fragment. Note that you do not HAVE to use this specific code, if your code already has equivalent features!   Step 1: Main file     You may or may not have a main file. The following should be adapted to your circumstances. You do not need to create a file that is called main.do if you already have one, but you may need to update your existing main file.      Reference: https://larsvilhuber.github.io/self-checking-reproducibility/02-hands_off_running.html   Creating a single main file is straightforward. However, you will want to make some minor edits depending on where, in the above template setup, the file is located:  Scenario A: main is in the code directory  The most frequent scenario we see (which we call Scenario A) amongst economists is that the main file is in the code directory:  README.pdf data/ ... code/   main.do   01_readcps.do   02_readfred.do ...   In this case, the following generic main file will work, with scenario set to &quot;A&quot;.  local scenario &quot;A&quot;          // Scenario A: main is in code directory local pwd : pwd                     // This always captures the current directory  if &quot;`scenario&#39;&quot; == &quot;A&quot; {             // If in Scenario A, we need to change directory first     cd .. } global rootdir : pwd                // Now capture the directory to use as rootdir display in red &quot;Rootdir has been set to: $rootdir&quot; cd &quot;`pwd&#39;&quot;                            // Return to where we were before and never again use cd  // Now run the rest of the code do &quot;$rootdir/code/01_readcps.do&quot; do &quot;$rootdir/code/02_readfred.do&quot; do &quot;$rootdir/code/03_table1-5.do&quot; do &quot;$rootdir/code/04_figures1-4.do&quot;   Scenario B: main is in the top-level directory  More common in other computational sciences, but also present amongst economists, is that the main file is in the top-level directory:  README.pdf main.do data/ ... code/   01_readcps.do   02_readfred.do ...   In this case, the following generic main file will work, with scenario set to &quot;B&quot;(though see Step 3 Dependencies)  local scenario &quot;B&quot;          // Scenario B: main is in project top-level directory local pwd : pwd                     // This always captures the current directory  if &quot;`scenario&#39;&quot; == &quot;A&quot; {             // If in Scenario A, we need to change directory first     cd .. } global rootdir : pwd                // Now capture the directory to use as rootdir display in red &quot;Rootdir has been set to: $rootdir&quot; cd &quot;`pwd&#39;&quot;                            // Return to where we were before and never again use cd  // Now run the rest of the code do &quot;$rootdir/code/01_readcps.do&quot; do &quot;$rootdir/code/02_readfred.do&quot; do &quot;$rootdir/code/03_table1-5.do&quot; do &quot;$rootdir/code/04_figures1-4.do&quot;   Important     In neither scenario did we hard-code the path to our project directory /my/computer/users/me/project. This is not an omission, and it is important, because it allows the code to be run on any computer, without modification.   Finally, you should not hard-code your rootdir. Set the project root directory dynamically:  global rootdir : pwd      # if using the here package: rootdir &lt;- here::here() # or the rprojroot package rootdir &lt;- rprojroot::find_root_file(&quot;README.pdf&quot;)  # or other marker file      IMPORTANT: your code MUST contain the line (Stata) global rootdir : pwd (or equivalent) to set the project root directory dynamically.   Step 2: Path names and case  Two issues:          Windows computers use \ (backslashes) in path names, while Mac and Linux computers use / (forward slashes). The use of \ (backslashes) in path names breaks code on Mac and Linux computers.           Windows and Mac computers use case-insensitive file systems, while Linux computers use case-sensitive file systems.      Both of these issues need to be addressed. You are helped by a straightforward but often forgotten (or unknown) observation:     Every statistical programming language can use generic path names using / (forward slashes). This ensures wide reproducibility.   About 40% of replication packages in economics appear to be submitted by researchers using computers running MacOS or Linux. With a bit of simplified math, if we believe that is representative of what future replicators will do, that means that 40% of users will not be able to run 60% of replication packages without some potentially widespread edits, because of those backslashes.  You should thus replace all path names in your code to use / (forward slashes), or appropriate functions, and take care to write case-sensitive file and path names. This is straightforward:  Stata  // Instead of use &quot;data\analysis\combined_data.dta&quot;, clear // Use use &quot;data/analysis/combined_data.dta&quot;, clear // or better use &quot;$rootdir/data/analysis/combined_data.dta&quot;, clear   R  # Instead of data &lt;- read.csv(&quot;data\\analysis\\combined_data.csv&quot;) # Use data &lt;- read.csv(&quot;data/analysis/combined_data.csv&quot;) # or better data &lt;- read.csv(file.path(rootdir, &quot;data&quot;, &quot;analysis&quot;, &quot;combined_data.csv&quot;))   and similarly for other languages.  Implementing  In many cases, you can just globally replace all \ with / in your code files. Caution however is warranted if your code explicitly writes out $LaTeX$ code, which also (legitimately) uses \. In that case, you will need to be more careful.  Expert tip  If using a (Bash or Zsh) terminal, you likely have the sed command available. You can use it to replace all backslashes with forward slashes in all .do files in the code directory as follows:  sed -i &#39;s+\\+/+g&#39; code/*.do   Step 3: Dependencies  Stata packages  Stata users frequently use user-written packages, which are made available to the Stata community via the Stata Journal, SSC, or Github. They are typically installed using a small number of variants of the net install command (including ssc install).  Replicators need to have the same versions of these packages installed. Stata does not (currently) provide a way to install older versions of packages, and a regular occurrence of reproducibility failure is due to changes in packages over time. We have some simple solutions to this problem.  First, use an environment to permanently install-project specific packages once and for all.  Define the environment in your main file, after setting $rootdir:     Reference: https://larsvilhuber.github.io/self-checking-reproducibility/12-environments-in-stata.html and https://github.com/AEADataEditor/replication-template/blob/master/template-config.do#L129.   /* install any packages locally */ di &quot;=== Redirecting where Stata searches for ado files ===&quot; capture mkdir &quot;$rootdir/ado&quot; adopath - PERSONAL adopath - OLDPLACE adopath - SITE sysdir set PLUS     &quot;$rootdir/ado/plus&quot; sysdir set PERSONAL &quot;$rootdir/ado&quot;       // may be needed for some packages sysdir   From this point on, all installed packages will be installed into $rootdir/ado, and Stata will look there first when loading packages.  Install packages once if not present, but don’t reinstall if already present.     Reference: https://gist.github.com/larsvilhuber/d8b643a408d425ef2a80385b6377870d#file-part2_of_main-do-L14, though you should be able to just use your own install code as well, if it worked before.   *** Add required packages from SSC to this list *** local ssc_packages &quot;&quot;     // Example:     // local ssc_packages &quot;estout boottest&quot;     //      display in red &quot;============ Installing packages/commands from SSC =============&quot;     display in red &quot;== Packages: `ssc_packages&#39;&quot;     if !missing(&quot;`ssc_packages&#39;&quot;) {         foreach pkg in `ssc_packages&#39; {             capture which `pkg&#39;             if _rc == 111 {                                 dis &quot;Installing `pkg&#39;&quot;                 ssc install `pkg&#39;             }             which `pkg&#39;         }     } ado   Some special cases (usually not necessary)  For some packages, the package name is not the same thing as the command name. Example: moremata. For these packages, the above code does not work. Use this code:1     Reference: https://gist.github.com/larsvilhuber/d8b643a408d425ef2a80385b6377870d#file-part2_of_main-do-L27       // If you have packages that need to be unconditionally installed (the name of the package differs from the included commands), then list them here.     // examples are moremata, egennmore, blindschemes, etc. local ssc_unconditional &quot;&quot; /* add unconditionally installed packages */     display in red &quot;=============== Unconditionally installed packages from SSC ===============&quot;     display in red &quot;== Packages: `ssc_unconditional&#39;&quot;     if !missing(&quot;`ssc_unconditional&#39;&quot;) {         foreach pkg in `ssc_unconditional&#39; {             dis &quot;Installing `pkg&#39;&quot;             cap ssc install `pkg&#39;         }     } ado   Packages that are not on SSC may need to be net installed from other sources, including Github and personal websites. Again, this does not neatly work with a specific command check, and thus you may need to unconditionally install them. Use this code:      // If you have packages that need to be unconditionally installed from other sources (not SSC), then list them here.     // Example: grc1leg   net install grc1leg, from(&quot;http://www.stata.com/users/vwiggins/&quot;)     // Example when net install is not an option    cap mkdir &quot;$rootdir/ado/plus/e&quot;   cap copy http://www.sacarny.com/wp-content/uploads/2015/08/ebayes.ado &quot;$rootdir/ado/plus/e/ebayes.ado&quot; ado   Adding to replication package  The following files should be included in your replication package:  code/ado/*   R packages  For R packages, we suggest that users use renv, and do not set a specific CRAN mirror. We refer users to the renv documentation for details, but in a nutshell, for an existing R project that is not using renv, the following commands should be run in the R console:  install.packages(&quot;renv&quot;)  # only once renv::init()               # only once per project renv::snapshot()           # only once per project, after all packages are installed. You should choose to install all packages detected, then snapshotting. renv::status()             # to check status   This will create a file renv.lock in the top-level directory of your project.  Adding to replication package  The following files should be included in your replication package:  .Rprofile renv.lock renv/activate.R renv/settings.json   Do not include the entire renv directory, in particular not the renv/library subdirectory, as it is platform-specific (of no use to other platforms), and can be very large.  Step 4: Displays  Displays (figures and tables) should be written out to external files, and the authors’ versions, as used in the manuscript, should be provided. In the prototypical replication package structure above, these files would be in the results directory.     Reference: https://larsvilhuber.github.io/self-checking-reproducibility/03-automatically_saving_figures.html and https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures   Figures     All figures can be written out to files. Journals like pdf and eps files, but png are convenient. You can output multiple formats.   Whenever you have displayed a figure, also exportit to a file. It’s a simple command.   Stata  // Example for PNG graph export &quot;$rootdir/results/figure1.png&quot;, replace width(1200) height(800)  // Example for PDF graph export &quot;$rootdir/results/figure1.pdf&quot;, replace   R  # Example for PNG if using standard R png(filename = file.path(rootdir, &quot;results&quot;, &quot;figure1.png&quot;), width = 1200, height = 800) plot(x, y)  # your plotting code here dev.off()  # Example if using ggplot2 ggsave(filename = file.path(rootdir, &quot;results&quot;, &quot;figure1.png&quot;), plot = myplot, width = 12, height = 8, units = &quot;in&quot;, dpi = 100)   More complex figures  For more complex figures, it may be easier to simply write out the data underlying the figure to an Excel sheet, and create the figure there. See https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures#arbitrary-data-to-excel  on how to write out the underlying data. You would then include the Excel file that maps the data into a figure with your replication package.  Tables  Tables may be more complex. Simple tables can be written out using various tools:  Stata  esttab or outreg2, also putexcel. For fancier stuff, treat tables as data, use regsave or export excel to manipulate.  R  xtable, stargazer, others.  More complex tables  For more complex tables, it may be easier to simply write out entire matrices, or individual numbers, to an Excel sheet, and compose the table there. See https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures#examples for an example, especially if you have already been compiling your tables in Excel. You would then include the Excel file that maps the data into your preferred table layout with your replication package.  Step 5: Testing in containers  After you have made all the above changes, you should test your code in an appropriate authorized container.     ⚠️❗ IMPORTANT: If you do not have Docker installed on your computer, do not have the rights to install Docker on your computer, or do not have access otherwise to Docker, please do not attempt this, and skip straight to the alternative approach.      Reference: https://larsvilhuber.github.io/self-checking-reproducibility/80-docker.html   Authorized containers  The following list of containers are authorized for testing, as they are reliably available, and achieve the desired transparency.     Stata containers for versions 19now back to 11, provided by the Social Science Data Editors at https://hub.docker.com/u/dataeditors, such as dataeditors/stata18_5-mp:2025-02-26. (requires a license)   R containers provided by the Rocker Project, such as rocker/r-ver:4.3.1 or rocker/tidyverse:4.3.1 (which includes the tidyverse packages).   MATLAB + Dynare containers provided by the Dynare Project at https://hub.docker.com/r/dynare/dynare, such as dynare/dynare:5.3-2024-05-21. See the project page for the mapping betweeen containers and MATLAB versions. (requires a MATLAB license)   If you know of a different container that we should add to this list, please let us know. The AEA Data Editor’s Github profile has a few other containers that have worked, but may be too advanced for the typical user.     ⚠️❗ IMPORTANT: Do not provide us with a custom container that is not  on the above list. Transparency requires that the container be built, using a Dockerfile or apptainer.def file, from publicly available sources. While we will happily use your container, it must be built from one of the above sources, or well-known “standard” sources, such as “Docker Official Images” in the Dockerhub library space (e.g., https://hub.docker.com/_/python).   Steps     Install the software necessary for running containers.            For Windows, install Docker Desktop for Windows.       For Mac, install Docker Desktop for Mac or OrbStack.       For Linux, install Docker engine,  Podman, or use Apptainer. These can all also be installed on Windows under Windows Subsystem for Linux (WSL).           All example commands below are from a Bash or Zsh terminal, which are standard on Mac and Linux, as well as on Windows if using WSL. If you do not have WSL on Windows and are using the Powershell, the same principles apply, but the syntax may be different.      When code has been adjusted as in Steps 1-4, no complex adjustment of containers is necessary.      Run the container, mounting your project directory into the container. For example, if your project is in /my/computer/users/me/project, you would use a command such as this (example for Stata):   Preliminaries  (may need some adjustment, depending on your license)  VERSION=18_5 TAG=2025-02-26 MYHUBID=dataeditors MYIMG=stata${VERSION} CONTAINER=$MYHUBID/${MYIMG}-${TYPE}:${TAG}  TYPE=mp STATALIC=/path/to/your/stata/stata.lic   Explanations:     VERSION: This is the Stata version. StataNow is referenced with a _5 suffix, otherwise, this corresponds to your (major) Stata version number.   TAG: This is the date the container was built, in YYYY-MM-DD format. Recent Stata containers do not (on purpose) have a latest tag, but older ones (that are no longer maintained) do, and can replace the date with latest.   CONTAINER:  is the fully qualified name of the container to be used. It is built from various components. For Stata images, these are maintained by dataeditors on Dockerhub. All available Stata containers and tags can be viewed on https://hub.docker.com/u/dataeditors. The precise way to call the container may depend on the version. For instance, for versions prior to 18, the -${TYPE} suffix is not used.   STATALIC: Is the path (in the notation used by the terminal you are using) to your Stata license file stata.lic. You need to have a valid Stata license file for the version of Stata you are using.      If you have only an older license, or a non-MP license, you may need to replace VERSION, TAG, and TYPE accordingly. For instance, if you have a Stata 16 SE license, you would set VERSION=16, TAG=2023-06-13, and TYPE=se, and remove -${TYPE} from the CONTAINER definition.   Test the container  docker run -it --rm \   --volume ${STATALIC}:/usr/local/stata/stata.lic \   --entrypoint stata-${TYPE} \   ${CONTAINER}   You should see the usual Stata prompt. Type exit to leave Stata.  Run the container  docker run -it --rm \   --volume ${STATALIC}:/usr/local/stata/stata.lic \   --volume $(pwd):/project \   --workdir /project \   --entrypoint stata-${TYPE} \   ${CONTAINER} -b main.do   if using a Scenario B setup. If using a Scenario A setup, use  docker run -it --rm \   --volume ${STATALIC}:/usr/local/stata/stata.lic \   --volume $(pwd):/project \   --workdir /project/code \   --entrypoint stata-${TYPE} \   ${CONTAINER} -b main.do   Alternative approach  If you cannot run Docker on your computer, we make available the SIVACOR service, which allows you to run your code using authorized containers without the need to install software on your own computer, producing a Trusted Research Object (TRO).     In fact, we will run your code using this same system to verify compliance with all of the above steps!     For more information on how to use SIVACOR, see https://docs.sivacor.org/. Once you have successfully run your code on SIVACOR, provide the generated certified ZIP file  instead of the original replication package to the Data Editor. A TRO does not need to be re-run by the Data Editor.  Fallback: Run on a different computer  If you do not have, or cannot, install Docker, and you cannot use SIVACOR, use this alternative approach to test your code:     Download your entire replication package from the draft openICPSR deposit, onto a different computer where you have not previously run the code.   Run the code from that new location.            For Stata, close all Stata windows, and then double-click on the main.do file. This should generate a main.log file in the same directory as main.do.                    For R, from a terminal or the RStudio Terminal tab, type R CMD BATCH main.R, or if using renv, R --no-save --no-restore -f main.R &gt; main.Rout.2  This should generate a main.Rout file in the same directory as main.R.                           We note that in our experience, this approach is much less reliable.  Success  If your code does run into problems, the generated main.log or main.Rout should have clues as to what went wrong. You should be able to fix these issues, and re-run the code in the container, until it runs without error.  If your code runs without error, and produces all expected output files, you are done!  Finalize README     Reference: https://social-science-data-editors.github.io/template_README/template-README.html   This step is usually not necessary, but you want to just make sure that your README has the necessary information that help set expectations about computational feasibility, based on the steps above.     Software: If you used a container, specify which container you used (name and tag, e.g., dataeditors/stata18_5-mp:2025-02-26). Be precise when describing the StataMP version - the number of cores matters! (StataMP-4 may not behave the same way as StataMP-8.)   Hardware: Verify that the description of your computer (CPU, number of cores, RAM, disk space) is accurate.   Run time: Provide an estimate of the expected run time, however trivial it might be. It matters to the replicator!   Examples:  - OS: &quot;openSUSE Leap 15.6&quot; - Processor:  13th Gen Intel(R) Core(TM) i7-1365U, 12 cores - Memory available: 30GB memory - Docker version 28.4.0-ce, build 249d679a6  - stata version 18-mp-i (Docker image dataeditors/stata18-mp-i:2024-12-18) (born date: &quot;18 Dec 2024&quot;) with 32 core license  Code ran for about 35 hours.   - OS: Windows Server AMD EPYC 7763 64-Core Processor 2.44 GHz, 128GB - Stata/MP4 19.5 (&quot;21 May 2025&quot;) - MATLAB R2025a  Code runs about 10 minutes for Stata portion, and about 5 days for MATLAB portion.   Submitting  You can now submit your replication package to the Data Editor, along with the completed checklist from above, and the generated main.log/main.Rout as evidence.  Problems?  If you run into problems in Step 5, no worries, simply submit all the files as modified in Steps 1-4, along with the completed checklist, and we will handle the remaining issues.                A more customized setup might check for a package-specific file in the ado directory, such as the &lt;package&gt;.pkg, but this is more complex and may not always work. &#8617;                 In PowerShell, you can use R --no-save --no-restore -f main.R | Out-File -Encoding UTF8 main.Rout. &#8617;">


  <meta name="author" content="AEA Data Editor">
  
  <meta property="article:author" content="AEA Data Editor">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Office of the AEA Data Editor">
<meta property="og:title" content="Preparing your code for computational verification">
<meta property="og:url" content="https://aeadataeditor.github.io/aea-de-guidance/preparing-replication-package">


  <meta property="og:description" content="The steps in this document are being used in a pilot project.   This document describes how to prepare your code for verification, taking into account some of the most frequent issues that the Data Editor and his team have encountered in submitted replication packages.     ⚠️❗ IMPORTANT: At this point, you should only be seeing this page if you were asked by the Data Editor team to do so, and if your replication package relies on a single software. Admissible containers are listed in the Step 5 section: authorized containers. We are not currently attempting to generalize this to multi-software replication packages, though it is possible to do so.   Overview  We will describe a few checks and edits you should make to your code, in order to ensure maximum reproducibility. We then describe how to test for reproducibility before submitting to the Data Editor. All steps have been tested by undergraduate replicators, and should be easy to implement. Whether they take a lot of time depends on your specific code, but generally, these adjustments can be made by somebody with good knowledge of the code base very quickly.  Much more extensive guidance on the issues addressed here is available at https://larsvilhuber.github.io/self-checking-reproducibility/. We reference specific chapters there at each of the steps.     ⚠️❗ IMPORTANT: All but the last steps can be done by anybody, no special system requirements required, and independent of your ability to share confidential data. However, the last step may not be possible in an institution that does not allow you to install container software (Docker, OrbStack, etc.), and does not have such technology installed on a Linux cluster. We provide a public website where you can leverage containers for verification, but you should not use it for confidential data. In that case, please do all the other steps.     Checklist  Print off (as PDF or on paper) the following checklist, and tick off each item as you complete it. Provide the completed checklist as part of the replication package.     Step 1: Main file: A single main file is provided that runs all code.   Step 2: Path names: All paths in code use / (forward slashes) relative to a single top-level project directory ($rootdir, $basedir, etc.). The top-level project directory is set dynamically, not hard-coded (explanations below).   Step 3: Dependencies: All packages/libraries/dependencies are installed via code once.            For Stata, these packages are installed into a subdirectory in the project ($rootdir/ado, $basedir/adofiles, etc.), and used by the code.       For R, renv is used (exceptions made for other package management systems if such a system is explained).       For Python, environments are used (native venv or conda), and the necessary top-level requirements specified (no OS-specific dependencies are included).           Step 4: Displays: All figures and tables are written out to clearly identified external files, and the authors’ versions, as used in the manuscript, are provided.   Step 5: Testing in containers: After all changes were made, the code was run            using an appropriate authorized container, and the generated log files are provided.       using the provided website, a certified ZIP file was created, and is provided instead of the original replication package.           (usually not necessary) Finalize: Update the README with the necessary information about computer specifications, Docker image used, memory and disk space requirements, and expected runtime.       Detailed instructions  Preliminary: Directory structure of a replication package  A generic replication package, housed at /my/computer/users/me/project, might have the following structure:  README.pdf data/    raw/       cps0001.dat    analysis/       combined_data.dta       combined_data.csv       combined_data_codebook.pdf code/   01_readcps.do   02_readfred.do   03_table1-5.do   04_figures1-4.do results/   table1.tex   table2.xlsx   ...   figure1.png   figure2.pdf   where     data/raw has the externally acquired raw data files (not modified by the authors)   data/analysis has the processed data files, generated by the code in this repository.   code has the code files.   results has all the results files.   For illustration purposes, we have used Stata .do files, and outputs in a variety of formats, but the same principles apply to other software, and to any output formats.     Note that we did not specify where the main.do file will be!   Short-cut     If you want to include the key code pieces for Stata that are needed to comply with Steps 1-3, you can use  this code fragment. Note that you do not HAVE to use this specific code, if your code already has equivalent features!   Step 1: Main file     You may or may not have a main file. The following should be adapted to your circumstances. You do not need to create a file that is called main.do if you already have one, but you may need to update your existing main file.      Reference: https://larsvilhuber.github.io/self-checking-reproducibility/02-hands_off_running.html   Creating a single main file is straightforward. However, you will want to make some minor edits depending on where, in the above template setup, the file is located:  Scenario A: main is in the code directory  The most frequent scenario we see (which we call Scenario A) amongst economists is that the main file is in the code directory:  README.pdf data/ ... code/   main.do   01_readcps.do   02_readfred.do ...   In this case, the following generic main file will work, with scenario set to &quot;A&quot;.  local scenario &quot;A&quot;          // Scenario A: main is in code directory local pwd : pwd                     // This always captures the current directory  if &quot;`scenario&#39;&quot; == &quot;A&quot; {             // If in Scenario A, we need to change directory first     cd .. } global rootdir : pwd                // Now capture the directory to use as rootdir display in red &quot;Rootdir has been set to: $rootdir&quot; cd &quot;`pwd&#39;&quot;                            // Return to where we were before and never again use cd  // Now run the rest of the code do &quot;$rootdir/code/01_readcps.do&quot; do &quot;$rootdir/code/02_readfred.do&quot; do &quot;$rootdir/code/03_table1-5.do&quot; do &quot;$rootdir/code/04_figures1-4.do&quot;   Scenario B: main is in the top-level directory  More common in other computational sciences, but also present amongst economists, is that the main file is in the top-level directory:  README.pdf main.do data/ ... code/   01_readcps.do   02_readfred.do ...   In this case, the following generic main file will work, with scenario set to &quot;B&quot;(though see Step 3 Dependencies)  local scenario &quot;B&quot;          // Scenario B: main is in project top-level directory local pwd : pwd                     // This always captures the current directory  if &quot;`scenario&#39;&quot; == &quot;A&quot; {             // If in Scenario A, we need to change directory first     cd .. } global rootdir : pwd                // Now capture the directory to use as rootdir display in red &quot;Rootdir has been set to: $rootdir&quot; cd &quot;`pwd&#39;&quot;                            // Return to where we were before and never again use cd  // Now run the rest of the code do &quot;$rootdir/code/01_readcps.do&quot; do &quot;$rootdir/code/02_readfred.do&quot; do &quot;$rootdir/code/03_table1-5.do&quot; do &quot;$rootdir/code/04_figures1-4.do&quot;   Important     In neither scenario did we hard-code the path to our project directory /my/computer/users/me/project. This is not an omission, and it is important, because it allows the code to be run on any computer, without modification.   Finally, you should not hard-code your rootdir. Set the project root directory dynamically:  global rootdir : pwd      # if using the here package: rootdir &lt;- here::here() # or the rprojroot package rootdir &lt;- rprojroot::find_root_file(&quot;README.pdf&quot;)  # or other marker file      IMPORTANT: your code MUST contain the line (Stata) global rootdir : pwd (or equivalent) to set the project root directory dynamically.   Step 2: Path names and case  Two issues:          Windows computers use \ (backslashes) in path names, while Mac and Linux computers use / (forward slashes). The use of \ (backslashes) in path names breaks code on Mac and Linux computers.           Windows and Mac computers use case-insensitive file systems, while Linux computers use case-sensitive file systems.      Both of these issues need to be addressed. You are helped by a straightforward but often forgotten (or unknown) observation:     Every statistical programming language can use generic path names using / (forward slashes). This ensures wide reproducibility.   About 40% of replication packages in economics appear to be submitted by researchers using computers running MacOS or Linux. With a bit of simplified math, if we believe that is representative of what future replicators will do, that means that 40% of users will not be able to run 60% of replication packages without some potentially widespread edits, because of those backslashes.  You should thus replace all path names in your code to use / (forward slashes), or appropriate functions, and take care to write case-sensitive file and path names. This is straightforward:  Stata  // Instead of use &quot;data\analysis\combined_data.dta&quot;, clear // Use use &quot;data/analysis/combined_data.dta&quot;, clear // or better use &quot;$rootdir/data/analysis/combined_data.dta&quot;, clear   R  # Instead of data &lt;- read.csv(&quot;data\\analysis\\combined_data.csv&quot;) # Use data &lt;- read.csv(&quot;data/analysis/combined_data.csv&quot;) # or better data &lt;- read.csv(file.path(rootdir, &quot;data&quot;, &quot;analysis&quot;, &quot;combined_data.csv&quot;))   and similarly for other languages.  Implementing  In many cases, you can just globally replace all \ with / in your code files. Caution however is warranted if your code explicitly writes out $LaTeX$ code, which also (legitimately) uses \. In that case, you will need to be more careful.  Expert tip  If using a (Bash or Zsh) terminal, you likely have the sed command available. You can use it to replace all backslashes with forward slashes in all .do files in the code directory as follows:  sed -i &#39;s+\\+/+g&#39; code/*.do   Step 3: Dependencies  Stata packages  Stata users frequently use user-written packages, which are made available to the Stata community via the Stata Journal, SSC, or Github. They are typically installed using a small number of variants of the net install command (including ssc install).  Replicators need to have the same versions of these packages installed. Stata does not (currently) provide a way to install older versions of packages, and a regular occurrence of reproducibility failure is due to changes in packages over time. We have some simple solutions to this problem.  First, use an environment to permanently install-project specific packages once and for all.  Define the environment in your main file, after setting $rootdir:     Reference: https://larsvilhuber.github.io/self-checking-reproducibility/12-environments-in-stata.html and https://github.com/AEADataEditor/replication-template/blob/master/template-config.do#L129.   /* install any packages locally */ di &quot;=== Redirecting where Stata searches for ado files ===&quot; capture mkdir &quot;$rootdir/ado&quot; adopath - PERSONAL adopath - OLDPLACE adopath - SITE sysdir set PLUS     &quot;$rootdir/ado/plus&quot; sysdir set PERSONAL &quot;$rootdir/ado&quot;       // may be needed for some packages sysdir   From this point on, all installed packages will be installed into $rootdir/ado, and Stata will look there first when loading packages.  Install packages once if not present, but don’t reinstall if already present.     Reference: https://gist.github.com/larsvilhuber/d8b643a408d425ef2a80385b6377870d#file-part2_of_main-do-L14, though you should be able to just use your own install code as well, if it worked before.   *** Add required packages from SSC to this list *** local ssc_packages &quot;&quot;     // Example:     // local ssc_packages &quot;estout boottest&quot;     //      display in red &quot;============ Installing packages/commands from SSC =============&quot;     display in red &quot;== Packages: `ssc_packages&#39;&quot;     if !missing(&quot;`ssc_packages&#39;&quot;) {         foreach pkg in `ssc_packages&#39; {             capture which `pkg&#39;             if _rc == 111 {                                 dis &quot;Installing `pkg&#39;&quot;                 ssc install `pkg&#39;             }             which `pkg&#39;         }     } ado   Some special cases (usually not necessary)  For some packages, the package name is not the same thing as the command name. Example: moremata. For these packages, the above code does not work. Use this code:1     Reference: https://gist.github.com/larsvilhuber/d8b643a408d425ef2a80385b6377870d#file-part2_of_main-do-L27       // If you have packages that need to be unconditionally installed (the name of the package differs from the included commands), then list them here.     // examples are moremata, egennmore, blindschemes, etc. local ssc_unconditional &quot;&quot; /* add unconditionally installed packages */     display in red &quot;=============== Unconditionally installed packages from SSC ===============&quot;     display in red &quot;== Packages: `ssc_unconditional&#39;&quot;     if !missing(&quot;`ssc_unconditional&#39;&quot;) {         foreach pkg in `ssc_unconditional&#39; {             dis &quot;Installing `pkg&#39;&quot;             cap ssc install `pkg&#39;         }     } ado   Packages that are not on SSC may need to be net installed from other sources, including Github and personal websites. Again, this does not neatly work with a specific command check, and thus you may need to unconditionally install them. Use this code:      // If you have packages that need to be unconditionally installed from other sources (not SSC), then list them here.     // Example: grc1leg   net install grc1leg, from(&quot;http://www.stata.com/users/vwiggins/&quot;)     // Example when net install is not an option    cap mkdir &quot;$rootdir/ado/plus/e&quot;   cap copy http://www.sacarny.com/wp-content/uploads/2015/08/ebayes.ado &quot;$rootdir/ado/plus/e/ebayes.ado&quot; ado   Adding to replication package  The following files should be included in your replication package:  code/ado/*   R packages  For R packages, we suggest that users use renv, and do not set a specific CRAN mirror. We refer users to the renv documentation for details, but in a nutshell, for an existing R project that is not using renv, the following commands should be run in the R console:  install.packages(&quot;renv&quot;)  # only once renv::init()               # only once per project renv::snapshot()           # only once per project, after all packages are installed. You should choose to install all packages detected, then snapshotting. renv::status()             # to check status   This will create a file renv.lock in the top-level directory of your project.  Adding to replication package  The following files should be included in your replication package:  .Rprofile renv.lock renv/activate.R renv/settings.json   Do not include the entire renv directory, in particular not the renv/library subdirectory, as it is platform-specific (of no use to other platforms), and can be very large.  Step 4: Displays  Displays (figures and tables) should be written out to external files, and the authors’ versions, as used in the manuscript, should be provided. In the prototypical replication package structure above, these files would be in the results directory.     Reference: https://larsvilhuber.github.io/self-checking-reproducibility/03-automatically_saving_figures.html and https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures   Figures     All figures can be written out to files. Journals like pdf and eps files, but png are convenient. You can output multiple formats.   Whenever you have displayed a figure, also exportit to a file. It’s a simple command.   Stata  // Example for PNG graph export &quot;$rootdir/results/figure1.png&quot;, replace width(1200) height(800)  // Example for PDF graph export &quot;$rootdir/results/figure1.pdf&quot;, replace   R  # Example for PNG if using standard R png(filename = file.path(rootdir, &quot;results&quot;, &quot;figure1.png&quot;), width = 1200, height = 800) plot(x, y)  # your plotting code here dev.off()  # Example if using ggplot2 ggsave(filename = file.path(rootdir, &quot;results&quot;, &quot;figure1.png&quot;), plot = myplot, width = 12, height = 8, units = &quot;in&quot;, dpi = 100)   More complex figures  For more complex figures, it may be easier to simply write out the data underlying the figure to an Excel sheet, and create the figure there. See https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures#arbitrary-data-to-excel  on how to write out the underlying data. You would then include the Excel file that maps the data into a figure with your replication package.  Tables  Tables may be more complex. Simple tables can be written out using various tools:  Stata  esttab or outreg2, also putexcel. For fancier stuff, treat tables as data, use regsave or export excel to manipulate.  R  xtable, stargazer, others.  More complex tables  For more complex tables, it may be easier to simply write out entire matrices, or individual numbers, to an Excel sheet, and compose the table there. See https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures#examples for an example, especially if you have already been compiling your tables in Excel. You would then include the Excel file that maps the data into your preferred table layout with your replication package.  Step 5: Testing in containers  After you have made all the above changes, you should test your code in an appropriate authorized container.     ⚠️❗ IMPORTANT: If you do not have Docker installed on your computer, do not have the rights to install Docker on your computer, or do not have access otherwise to Docker, please do not attempt this, and skip straight to the alternative approach.      Reference: https://larsvilhuber.github.io/self-checking-reproducibility/80-docker.html   Authorized containers  The following list of containers are authorized for testing, as they are reliably available, and achieve the desired transparency.     Stata containers for versions 19now back to 11, provided by the Social Science Data Editors at https://hub.docker.com/u/dataeditors, such as dataeditors/stata18_5-mp:2025-02-26. (requires a license)   R containers provided by the Rocker Project, such as rocker/r-ver:4.3.1 or rocker/tidyverse:4.3.1 (which includes the tidyverse packages).   MATLAB + Dynare containers provided by the Dynare Project at https://hub.docker.com/r/dynare/dynare, such as dynare/dynare:5.3-2024-05-21. See the project page for the mapping betweeen containers and MATLAB versions. (requires a MATLAB license)   If you know of a different container that we should add to this list, please let us know. The AEA Data Editor’s Github profile has a few other containers that have worked, but may be too advanced for the typical user.     ⚠️❗ IMPORTANT: Do not provide us with a custom container that is not  on the above list. Transparency requires that the container be built, using a Dockerfile or apptainer.def file, from publicly available sources. While we will happily use your container, it must be built from one of the above sources, or well-known “standard” sources, such as “Docker Official Images” in the Dockerhub library space (e.g., https://hub.docker.com/_/python).   Steps     Install the software necessary for running containers.            For Windows, install Docker Desktop for Windows.       For Mac, install Docker Desktop for Mac or OrbStack.       For Linux, install Docker engine,  Podman, or use Apptainer. These can all also be installed on Windows under Windows Subsystem for Linux (WSL).           All example commands below are from a Bash or Zsh terminal, which are standard on Mac and Linux, as well as on Windows if using WSL. If you do not have WSL on Windows and are using the Powershell, the same principles apply, but the syntax may be different.      When code has been adjusted as in Steps 1-4, no complex adjustment of containers is necessary.      Run the container, mounting your project directory into the container. For example, if your project is in /my/computer/users/me/project, you would use a command such as this (example for Stata):   Preliminaries  (may need some adjustment, depending on your license)  VERSION=18_5 TAG=2025-02-26 MYHUBID=dataeditors MYIMG=stata${VERSION} CONTAINER=$MYHUBID/${MYIMG}-${TYPE}:${TAG}  TYPE=mp STATALIC=/path/to/your/stata/stata.lic   Explanations:     VERSION: This is the Stata version. StataNow is referenced with a _5 suffix, otherwise, this corresponds to your (major) Stata version number.   TAG: This is the date the container was built, in YYYY-MM-DD format. Recent Stata containers do not (on purpose) have a latest tag, but older ones (that are no longer maintained) do, and can replace the date with latest.   CONTAINER:  is the fully qualified name of the container to be used. It is built from various components. For Stata images, these are maintained by dataeditors on Dockerhub. All available Stata containers and tags can be viewed on https://hub.docker.com/u/dataeditors. The precise way to call the container may depend on the version. For instance, for versions prior to 18, the -${TYPE} suffix is not used.   STATALIC: Is the path (in the notation used by the terminal you are using) to your Stata license file stata.lic. You need to have a valid Stata license file for the version of Stata you are using.      If you have only an older license, or a non-MP license, you may need to replace VERSION, TAG, and TYPE accordingly. For instance, if you have a Stata 16 SE license, you would set VERSION=16, TAG=2023-06-13, and TYPE=se, and remove -${TYPE} from the CONTAINER definition.   Test the container  docker run -it --rm \   --volume ${STATALIC}:/usr/local/stata/stata.lic \   --entrypoint stata-${TYPE} \   ${CONTAINER}   You should see the usual Stata prompt. Type exit to leave Stata.  Run the container  docker run -it --rm \   --volume ${STATALIC}:/usr/local/stata/stata.lic \   --volume $(pwd):/project \   --workdir /project \   --entrypoint stata-${TYPE} \   ${CONTAINER} -b main.do   if using a Scenario B setup. If using a Scenario A setup, use  docker run -it --rm \   --volume ${STATALIC}:/usr/local/stata/stata.lic \   --volume $(pwd):/project \   --workdir /project/code \   --entrypoint stata-${TYPE} \   ${CONTAINER} -b main.do   Alternative approach  If you cannot run Docker on your computer, we make available the SIVACOR service, which allows you to run your code using authorized containers without the need to install software on your own computer, producing a Trusted Research Object (TRO).     In fact, we will run your code using this same system to verify compliance with all of the above steps!     For more information on how to use SIVACOR, see https://docs.sivacor.org/. Once you have successfully run your code on SIVACOR, provide the generated certified ZIP file  instead of the original replication package to the Data Editor. A TRO does not need to be re-run by the Data Editor.  Fallback: Run on a different computer  If you do not have, or cannot, install Docker, and you cannot use SIVACOR, use this alternative approach to test your code:     Download your entire replication package from the draft openICPSR deposit, onto a different computer where you have not previously run the code.   Run the code from that new location.            For Stata, close all Stata windows, and then double-click on the main.do file. This should generate a main.log file in the same directory as main.do.                    For R, from a terminal or the RStudio Terminal tab, type R CMD BATCH main.R, or if using renv, R --no-save --no-restore -f main.R &gt; main.Rout.2  This should generate a main.Rout file in the same directory as main.R.                           We note that in our experience, this approach is much less reliable.  Success  If your code does run into problems, the generated main.log or main.Rout should have clues as to what went wrong. You should be able to fix these issues, and re-run the code in the container, until it runs without error.  If your code runs without error, and produces all expected output files, you are done!  Finalize README     Reference: https://social-science-data-editors.github.io/template_README/template-README.html   This step is usually not necessary, but you want to just make sure that your README has the necessary information that help set expectations about computational feasibility, based on the steps above.     Software: If you used a container, specify which container you used (name and tag, e.g., dataeditors/stata18_5-mp:2025-02-26). Be precise when describing the StataMP version - the number of cores matters! (StataMP-4 may not behave the same way as StataMP-8.)   Hardware: Verify that the description of your computer (CPU, number of cores, RAM, disk space) is accurate.   Run time: Provide an estimate of the expected run time, however trivial it might be. It matters to the replicator!   Examples:  - OS: &quot;openSUSE Leap 15.6&quot; - Processor:  13th Gen Intel(R) Core(TM) i7-1365U, 12 cores - Memory available: 30GB memory - Docker version 28.4.0-ce, build 249d679a6  - stata version 18-mp-i (Docker image dataeditors/stata18-mp-i:2024-12-18) (born date: &quot;18 Dec 2024&quot;) with 32 core license  Code ran for about 35 hours.   - OS: Windows Server AMD EPYC 7763 64-Core Processor 2.44 GHz, 128GB - Stata/MP4 19.5 (&quot;21 May 2025&quot;) - MATLAB R2025a  Code runs about 10 minutes for Stata portion, and about 5 days for MATLAB portion.   Submitting  You can now submit your replication package to the Data Editor, along with the completed checklist from above, and the generated main.log/main.Rout as evidence.  Problems?  If you run into problems in Step 5, no worries, simply submit all the files as modified in Steps 1-4, along with the completed checklist, and we will handle the remaining issues.                A more customized setup might check for a package-specific file in the ado directory, such as the &lt;package&gt;.pkg, but this is more complex and may not always work. &#8617;                 In PowerShell, you can use R --no-save --no-restore -f main.R | Out-File -Encoding UTF8 main.Rout. &#8617;">







  <meta property="article:published_time" content="2025-12-04T00:00:00-05:00">






<link rel="canonical" href="https://aeadataeditor.github.io/aea-de-guidance/preparing-replication-package">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "AEA Data Editor",
      "url": "https://aeadataeditor.github.io/"
    
  }
</script>






<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Office of the AEA Data Editor Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/custom.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/images/logo-aea-88x88.jpg" alt="Office of the AEA Data Editor"></a>
        
        <a class="site-title" href="/">
          Office of the AEA Data Editor
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/aea-de-guidance/">START REPLICATION PACKAGE</a>
            </li><li class="masthead__menu-item">
              <a href="/aea-de-guidance/FAQ.html">FAQ</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/">Blog Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/talks/">Talks</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/">Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/surveys/">Surveys</a>
            </li><li class="masthead__menu-item">
              <a href="/publications/">Publications</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/logo-aea.jpg" alt="AEA Data Editor" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">AEA Data Editor</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>The AEA Data Editor’s mission is to design and oversee the AEA journals’ strategy for archiving and curating research data and promoting reproducible research.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      
        <li>
          <a href="https://mstdn.social/@aeadata" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span>
          </a>
        </li>
      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/aeadataeditor" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Preparing your code for computational verification">
    <meta itemprop="description" content="  The steps in this document are being used in a pilot project.This document describes how to prepare your code for verification, taking into account some of the most frequent issues that the Data Editor and his team have encountered in submitted replication packages.  ⚠️❗ IMPORTANT: At this point, you should only be seeing this page if you were asked by the Data Editor team to do so, and if your replication package relies on a single software. Admissible containers are listed in the Step 5 section: authorized containers. We are not currently attempting to generalize this to multi-software replication packages, though it is possible to do so.OverviewWe will describe a few checks and edits you should make to your code, in order to ensure maximum reproducibility. We then describe how to test for reproducibility before submitting to the Data Editor. All steps have been tested by undergraduate replicators, and should be easy to implement. Whether they take a lot of time depends on your specific code, but generally, these adjustments can be made by somebody with good knowledge of the code base very quickly.Much more extensive guidance on the issues addressed here is available at https://larsvilhuber.github.io/self-checking-reproducibility/. We reference specific chapters there at each of the steps.  ⚠️❗ IMPORTANT: All but the last steps can be done by anybody, no special system requirements required, and independent of your ability to share confidential data. However, the last step may not be possible in an institution that does not allow you to install container software (Docker, OrbStack, etc.), and does not have such technology installed on a Linux cluster. We provide a public website where you can leverage containers for verification, but you should not use it for confidential data. In that case, please do all the other steps.ChecklistPrint off (as PDF or on paper) the following checklist, and tick off each item as you complete it. Provide the completed checklist as part of the replication package.  Step 1: Main file: A single main file is provided that runs all code.  Step 2: Path names: All paths in code use / (forward slashes) relative to a single top-level project directory ($rootdir, $basedir, etc.). The top-level project directory is set dynamically, not hard-coded (explanations below).  Step 3: Dependencies: All packages/libraries/dependencies are installed via code once.          For Stata, these packages are installed into a subdirectory in the project ($rootdir/ado, $basedir/adofiles, etc.), and used by the code.      For R, renv is used (exceptions made for other package management systems if such a system is explained).      For Python, environments are used (native venv or conda), and the necessary top-level requirements specified (no OS-specific dependencies are included).        Step 4: Displays: All figures and tables are written out to clearly identified external files, and the authors’ versions, as used in the manuscript, are provided.  Step 5: Testing in containers: After all changes were made, the code was run          using an appropriate authorized container, and the generated log files are provided.      using the provided website, a certified ZIP file was created, and is provided instead of the original replication package.        (usually not necessary) Finalize: Update the README with the necessary information about computer specifications, Docker image used, memory and disk space requirements, and expected runtime.Detailed instructionsPreliminary: Directory structure of a replication packageA generic replication package, housed at /my/computer/users/me/project, might have the following structure:README.pdfdata/   raw/      cps0001.dat   analysis/      combined_data.dta      combined_data.csv      combined_data_codebook.pdfcode/  01_readcps.do  02_readfred.do  03_table1-5.do  04_figures1-4.doresults/  table1.tex  table2.xlsx  ...  figure1.png  figure2.pdfwhere  data/raw has the externally acquired raw data files (not modified by the authors)  data/analysis has the processed data files, generated by the code in this repository.  code has the code files.  results has all the results files.For illustration purposes, we have used Stata .do files, and outputs in a variety of formats, but the same principles apply to other software, and to any output formats.  Note that we did not specify where the main.do file will be!Short-cut  If you want to include the key code pieces for Stata that are needed to comply with Steps 1-3, you can use  this code fragment. Note that you do not HAVE to use this specific code, if your code already has equivalent features!Step 1: Main file  You may or may not have a main file. The following should be adapted to your circumstances. You do not need to create a file that is called main.do if you already have one, but you may need to update your existing main file.  Reference: https://larsvilhuber.github.io/self-checking-reproducibility/02-hands_off_running.htmlCreating a single main file is straightforward. However, you will want to make some minor edits depending on where, in the above template setup, the file is located:Scenario A: main is in the code directoryThe most frequent scenario we see (which we call Scenario A) amongst economists is that the main file is in the code directory:README.pdfdata/...code/  main.do  01_readcps.do  02_readfred.do...In this case, the following generic main file will work, with scenario set to &quot;A&quot;.local scenario &quot;A&quot;          // Scenario A: main is in code directorylocal pwd : pwd                     // This always captures the current directoryif &quot;`scenario&#39;&quot; == &quot;A&quot; {             // If in Scenario A, we need to change directory first    cd ..}global rootdir : pwd                // Now capture the directory to use as rootdirdisplay in red &quot;Rootdir has been set to: $rootdir&quot;cd &quot;`pwd&#39;&quot;                            // Return to where we were before and never again use cd// Now run the rest of the codedo &quot;$rootdir/code/01_readcps.do&quot;do &quot;$rootdir/code/02_readfred.do&quot;do &quot;$rootdir/code/03_table1-5.do&quot;do &quot;$rootdir/code/04_figures1-4.do&quot;Scenario B: main is in the top-level directoryMore common in other computational sciences, but also present amongst economists, is that the main file is in the top-level directory:README.pdfmain.dodata/...code/  01_readcps.do  02_readfred.do...In this case, the following generic main file will work, with scenario set to &quot;B&quot;(though see Step 3 Dependencies)local scenario &quot;B&quot;          // Scenario B: main is in project top-level directorylocal pwd : pwd                     // This always captures the current directoryif &quot;`scenario&#39;&quot; == &quot;A&quot; {             // If in Scenario A, we need to change directory first    cd ..}global rootdir : pwd                // Now capture the directory to use as rootdirdisplay in red &quot;Rootdir has been set to: $rootdir&quot;cd &quot;`pwd&#39;&quot;                            // Return to where we were before and never again use cd// Now run the rest of the codedo &quot;$rootdir/code/01_readcps.do&quot;do &quot;$rootdir/code/02_readfred.do&quot;do &quot;$rootdir/code/03_table1-5.do&quot;do &quot;$rootdir/code/04_figures1-4.do&quot;Important  In neither scenario did we hard-code the path to our project directory /my/computer/users/me/project. This is not an omission, and it is important, because it allows the code to be run on any computer, without modification.Finally, you should not hard-code your rootdir. Set the project root directory dynamically:global rootdir : pwd   # if using the here package:rootdir &lt;- here::here()# or the rprojroot packagerootdir &lt;- rprojroot::find_root_file(&quot;README.pdf&quot;)  # or other marker file  IMPORTANT: your code MUST contain the line (Stata) global rootdir : pwd (or equivalent) to set the project root directory dynamically.Step 2: Path names and caseTwo issues:      Windows computers use \ (backslashes) in path names, while Mac and Linux computers use / (forward slashes). The use of \ (backslashes) in path names breaks code on Mac and Linux computers.        Windows and Mac computers use case-insensitive file systems, while Linux computers use case-sensitive file systems.  Both of these issues need to be addressed. You are helped by a straightforward but often forgotten (or unknown) observation:  Every statistical programming language can use generic path names using / (forward slashes). This ensures wide reproducibility.About 40% of replication packages in economics appear to be submitted by researchers using computers running MacOS or Linux. With a bit of simplified math, if we believe that is representative of what future replicators will do, that means that 40% of users will not be able to run 60% of replication packages without some potentially widespread edits, because of those backslashes.You should thus replace all path names in your code to use / (forward slashes), or appropriate functions, and take care to write case-sensitive file and path names. This is straightforward:Stata// Instead ofuse &quot;data\analysis\combined_data.dta&quot;, clear// Useuse &quot;data/analysis/combined_data.dta&quot;, clear// or betteruse &quot;$rootdir/data/analysis/combined_data.dta&quot;, clearR# Instead ofdata &lt;- read.csv(&quot;data\\analysis\\combined_data.csv&quot;)# Usedata &lt;- read.csv(&quot;data/analysis/combined_data.csv&quot;)# or betterdata &lt;- read.csv(file.path(rootdir, &quot;data&quot;, &quot;analysis&quot;, &quot;combined_data.csv&quot;))and similarly for other languages.ImplementingIn many cases, you can just globally replace all \ with / in your code files. Caution however is warranted if your code explicitly writes out $LaTeX$ code, which also (legitimately) uses \. In that case, you will need to be more careful.Expert tipIf using a (Bash or Zsh) terminal, you likely have the sed command available. You can use it to replace all backslashes with forward slashes in all .do files in the code directory as follows:sed -i &#39;s+\\+/+g&#39; code/*.doStep 3: DependenciesStata packagesStata users frequently use user-written packages, which are made available to the Stata community via the Stata Journal, SSC, or Github. They are typically installed using a small number of variants of the net install command (including ssc install).Replicators need to have the same versions of these packages installed. Stata does not (currently) provide a way to install older versions of packages, and a regular occurrence of reproducibility failure is due to changes in packages over time. We have some simple solutions to this problem.First, use an environment to permanently install-project specific packages once and for all.Define the environment in your main file, after setting $rootdir:  Reference: https://larsvilhuber.github.io/self-checking-reproducibility/12-environments-in-stata.html and https://github.com/AEADataEditor/replication-template/blob/master/template-config.do#L129./* install any packages locally */di &quot;=== Redirecting where Stata searches for ado files ===&quot;capture mkdir &quot;$rootdir/ado&quot;adopath - PERSONALadopath - OLDPLACEadopath - SITEsysdir set PLUS     &quot;$rootdir/ado/plus&quot;sysdir set PERSONAL &quot;$rootdir/ado&quot;       // may be needed for some packagessysdirFrom this point on, all installed packages will be installed into $rootdir/ado, and Stata will look there first when loading packages.Install packages once if not present, but don’t reinstall if already present.  Reference: https://gist.github.com/larsvilhuber/d8b643a408d425ef2a80385b6377870d#file-part2_of_main-do-L14, though you should be able to just use your own install code as well, if it worked before.*** Add required packages from SSC to this list ***local ssc_packages &quot;&quot;    // Example:    // local ssc_packages &quot;estout boottest&quot;    //     display in red &quot;============ Installing packages/commands from SSC =============&quot;    display in red &quot;== Packages: `ssc_packages&#39;&quot;    if !missing(&quot;`ssc_packages&#39;&quot;) {        foreach pkg in `ssc_packages&#39; {            capture which `pkg&#39;            if _rc == 111 {                                dis &quot;Installing `pkg&#39;&quot;                ssc install `pkg&#39;            }            which `pkg&#39;        }    }adoSome special cases (usually not necessary)For some packages, the package name is not the same thing as the command name. Example: moremata. For these packages, the above code does not work. Use this code:1  Reference: https://gist.github.com/larsvilhuber/d8b643a408d425ef2a80385b6377870d#file-part2_of_main-do-L27    // If you have packages that need to be unconditionally installed (the name of the package differs from the included commands), then list them here.    // examples are moremata, egennmore, blindschemes, etc.local ssc_unconditional &quot;&quot;/* add unconditionally installed packages */    display in red &quot;=============== Unconditionally installed packages from SSC ===============&quot;    display in red &quot;== Packages: `ssc_unconditional&#39;&quot;    if !missing(&quot;`ssc_unconditional&#39;&quot;) {        foreach pkg in `ssc_unconditional&#39; {            dis &quot;Installing `pkg&#39;&quot;            cap ssc install `pkg&#39;        }    }adoPackages that are not on SSC may need to be net installed from other sources, including Github and personal websites. Again, this does not neatly work with a specific command check, and thus you may need to unconditionally install them. Use this code:    // If you have packages that need to be unconditionally installed from other sources (not SSC), then list them here.    // Example: grc1leg  net install grc1leg, from(&quot;http://www.stata.com/users/vwiggins/&quot;)    // Example when net install is not an option   cap mkdir &quot;$rootdir/ado/plus/e&quot;  cap copy http://www.sacarny.com/wp-content/uploads/2015/08/ebayes.ado &quot;$rootdir/ado/plus/e/ebayes.ado&quot;adoAdding to replication packageThe following files should be included in your replication package:code/ado/*R packagesFor R packages, we suggest that users use renv, and do not set a specific CRAN mirror. We refer users to the renv documentation for details, but in a nutshell, for an existing R project that is not using renv, the following commands should be run in the R console:install.packages(&quot;renv&quot;)  # only oncerenv::init()               # only once per projectrenv::snapshot()           # only once per project, after all packages are installed. You should choose to install all packages detected, then snapshotting.renv::status()             # to check statusThis will create a file renv.lock in the top-level directory of your project.Adding to replication packageThe following files should be included in your replication package:.Rprofilerenv.lockrenv/activate.Rrenv/settings.jsonDo not include the entire renv directory, in particular not the renv/library subdirectory, as it is platform-specific (of no use to other platforms), and can be very large.Step 4: DisplaysDisplays (figures and tables) should be written out to external files, and the authors’ versions, as used in the manuscript, should be provided. In the prototypical replication package structure above, these files would be in the results directory.  Reference: https://larsvilhuber.github.io/self-checking-reproducibility/03-automatically_saving_figures.html and https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figuresFigures  All figures can be written out to files. Journals like pdf and eps files, but png are convenient. You can output multiple formats.  Whenever you have displayed a figure, also exportit to a file. It’s a simple command.Stata// Example for PNGgraph export &quot;$rootdir/results/figure1.png&quot;, replace width(1200) height(800) // Example for PDFgraph export &quot;$rootdir/results/figure1.pdf&quot;, replaceR# Example for PNG if using standard Rpng(filename = file.path(rootdir, &quot;results&quot;, &quot;figure1.png&quot;), width = 1200, height = 800)plot(x, y)  # your plotting code heredev.off() # Example if using ggplot2ggsave(filename = file.path(rootdir, &quot;results&quot;, &quot;figure1.png&quot;), plot = myplot, width = 12, height = 8, units = &quot;in&quot;, dpi = 100)More complex figuresFor more complex figures, it may be easier to simply write out the data underlying the figure to an Excel sheet, and create the figure there. See https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures#arbitrary-data-to-excel  on how to write out the underlying data. You would then include the Excel file that maps the data into a figure with your replication package.TablesTables may be more complex. Simple tables can be written out using various tools:Stataesttab or outreg2, also putexcel. For fancier stuff, treat tables as data, use regsave or export excel to manipulate.Rxtable, stargazer, others.More complex tablesFor more complex tables, it may be easier to simply write out entire matrices, or individual numbers, to an Excel sheet, and compose the table there. See https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures#examples for an example, especially if you have already been compiling your tables in Excel. You would then include the Excel file that maps the data into your preferred table layout with your replication package.Step 5: Testing in containersAfter you have made all the above changes, you should test your code in an appropriate authorized container.  ⚠️❗ IMPORTANT: If you do not have Docker installed on your computer, do not have the rights to install Docker on your computer, or do not have access otherwise to Docker, please do not attempt this, and skip straight to the alternative approach.  Reference: https://larsvilhuber.github.io/self-checking-reproducibility/80-docker.htmlAuthorized containersThe following list of containers are authorized for testing, as they are reliably available, and achieve the desired transparency.  Stata containers for versions 19now back to 11, provided by the Social Science Data Editors at https://hub.docker.com/u/dataeditors, such as dataeditors/stata18_5-mp:2025-02-26. (requires a license)  R containers provided by the Rocker Project, such as rocker/r-ver:4.3.1 or rocker/tidyverse:4.3.1 (which includes the tidyverse packages).  MATLAB + Dynare containers provided by the Dynare Project at https://hub.docker.com/r/dynare/dynare, such as dynare/dynare:5.3-2024-05-21. See the project page for the mapping betweeen containers and MATLAB versions. (requires a MATLAB license)If you know of a different container that we should add to this list, please let us know. The AEA Data Editor’s Github profile has a few other containers that have worked, but may be too advanced for the typical user.  ⚠️❗ IMPORTANT: Do not provide us with a custom container that is not  on the above list. Transparency requires that the container be built, using a Dockerfile or apptainer.def file, from publicly available sources. While we will happily use your container, it must be built from one of the above sources, or well-known “standard” sources, such as “Docker Official Images” in the Dockerhub library space (e.g., https://hub.docker.com/_/python).Steps  Install the software necessary for running containers.          For Windows, install Docker Desktop for Windows.      For Mac, install Docker Desktop for Mac or OrbStack.      For Linux, install Docker engine,  Podman, or use Apptainer. These can all also be installed on Windows under Windows Subsystem for Linux (WSL).        All example commands below are from a Bash or Zsh terminal, which are standard on Mac and Linux, as well as on Windows if using WSL. If you do not have WSL on Windows and are using the Powershell, the same principles apply, but the syntax may be different.  When code has been adjusted as in Steps 1-4, no complex adjustment of containers is necessary.  Run the container, mounting your project directory into the container. For example, if your project is in /my/computer/users/me/project, you would use a command such as this (example for Stata):Preliminaries(may need some adjustment, depending on your license)VERSION=18_5TAG=2025-02-26MYHUBID=dataeditorsMYIMG=stata${VERSION}CONTAINER=$MYHUBID/${MYIMG}-${TYPE}:${TAG} TYPE=mpSTATALIC=/path/to/your/stata/stata.licExplanations:  VERSION: This is the Stata version. StataNow is referenced with a _5 suffix, otherwise, this corresponds to your (major) Stata version number.  TAG: This is the date the container was built, in YYYY-MM-DD format. Recent Stata containers do not (on purpose) have a latest tag, but older ones (that are no longer maintained) do, and can replace the date with latest.  CONTAINER:  is the fully qualified name of the container to be used. It is built from various components. For Stata images, these are maintained by dataeditors on Dockerhub. All available Stata containers and tags can be viewed on https://hub.docker.com/u/dataeditors. The precise way to call the container may depend on the version. For instance, for versions prior to 18, the -${TYPE} suffix is not used.  STATALIC: Is the path (in the notation used by the terminal you are using) to your Stata license file stata.lic. You need to have a valid Stata license file for the version of Stata you are using.  If you have only an older license, or a non-MP license, you may need to replace VERSION, TAG, and TYPE accordingly. For instance, if you have a Stata 16 SE license, you would set VERSION=16, TAG=2023-06-13, and TYPE=se, and remove -${TYPE} from the CONTAINER definition.Test the containerdocker run -it --rm \  --volume ${STATALIC}:/usr/local/stata/stata.lic \  --entrypoint stata-${TYPE} \  ${CONTAINER}You should see the usual Stata prompt. Type exit to leave Stata.Run the containerdocker run -it --rm \  --volume ${STATALIC}:/usr/local/stata/stata.lic \  --volume $(pwd):/project \  --workdir /project \  --entrypoint stata-${TYPE} \  ${CONTAINER} -b main.doif using a Scenario B setup. If using a Scenario A setup, usedocker run -it --rm \  --volume ${STATALIC}:/usr/local/stata/stata.lic \  --volume $(pwd):/project \  --workdir /project/code \  --entrypoint stata-${TYPE} \  ${CONTAINER} -b main.doAlternative approachIf you cannot run Docker on your computer, we make available the SIVACOR service, which allows you to run your code using authorized containers without the need to install software on your own computer, producing a Trusted Research Object (TRO).  In fact, we will run your code using this same system to verify compliance with all of the above steps!For more information on how to use SIVACOR, see https://docs.sivacor.org/. Once you have successfully run your code on SIVACOR, provide the generated certified ZIP file  instead of the original replication package to the Data Editor. A TRO does not need to be re-run by the Data Editor.Fallback: Run on a different computerIf you do not have, or cannot, install Docker, and you cannot use SIVACOR, use this alternative approach to test your code:  Download your entire replication package from the draft openICPSR deposit, onto a different computer where you have not previously run the code.  Run the code from that new location.          For Stata, close all Stata windows, and then double-click on the main.do file. This should generate a main.log file in the same directory as main.do.                  For R, from a terminal or the RStudio Terminal tab, type R CMD BATCH main.R, or if using renv, R --no-save --no-restore -f main.R &gt; main.Rout.2  This should generate a main.Rout file in the same directory as main.R.                    We note that in our experience, this approach is much less reliable.SuccessIf your code does run into problems, the generated main.log or main.Rout should have clues as to what went wrong. You should be able to fix these issues, and re-run the code in the container, until it runs without error.If your code runs without error, and produces all expected output files, you are done!Finalize README  Reference: https://social-science-data-editors.github.io/template_README/template-README.htmlThis step is usually not necessary, but you want to just make sure that your README has the necessary information that help set expectations about computational feasibility, based on the steps above.  Software: If you used a container, specify which container you used (name and tag, e.g., dataeditors/stata18_5-mp:2025-02-26). Be precise when describing the StataMP version - the number of cores matters! (StataMP-4 may not behave the same way as StataMP-8.)  Hardware: Verify that the description of your computer (CPU, number of cores, RAM, disk space) is accurate.  Run time: Provide an estimate of the expected run time, however trivial it might be. It matters to the replicator!Examples:- OS: &quot;openSUSE Leap 15.6&quot;- Processor:  13th Gen Intel(R) Core(TM) i7-1365U, 12 cores- Memory available: 30GB memory- Docker version 28.4.0-ce, build 249d679a6 - stata version 18-mp-i (Docker image dataeditors/stata18-mp-i:2024-12-18) (born date: &quot;18 Dec 2024&quot;) with 32 core licenseCode ran for about 35 hours.- OS: Windows Server AMD EPYC 7763 64-Core Processor 2.44 GHz, 128GB- Stata/MP4 19.5 (&quot;21 May 2025&quot;)- MATLAB R2025aCode runs about 10 minutes for Stata portion, and about 5 days for MATLAB portion.SubmittingYou can now submit your replication package to the Data Editor, along with the completed checklist from above, and the generated main.log/main.Rout as evidence.Problems?If you run into problems in Step 5, no worries, simply submit all the files as modified in Steps 1-4, along with the completed checklist, and we will handle the remaining issues.            A more customized setup might check for a package-specific file in the ado directory, such as the &lt;package&gt;.pkg, but this is more complex and may not always work. &#8617;              In PowerShell, you can use R --no-save --no-restore -f main.R | Out-File -Encoding UTF8 main.Rout. &#8617;      ">
    <meta itemprop="datePublished" content="2025-12-04T00:00:00-05:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Preparing your code for computational verification
</h1>
          
        
        
        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2025-12-04T00:00:00-05:00">December 04, 2025</time></p>
        
        
        
             
        
    
        </header>
      

      <section class="page__content" itemprop="text">
       
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On This Page</h4></header>
              <ul class="toc__menu"><li><a href="#overview">Overview</a></li><li><a href="#checklist">Checklist</a></li><li><a href="#detailed-instructions">Detailed instructions</a><ul><li><a href="#preliminary-directory-structure-of-a-replication-package">Preliminary: Directory structure of a replication package</a></li><li><a href="#short-cut">Short-cut</a></li><li><a href="#step-1-main-file">Step 1: Main file</a><ul><li><a href="#scenario-a-main-is-in-the-code-directory">Scenario A: main is in the code directory</a></li><li><a href="#scenario-b-main-is-in-the-top-level-directory">Scenario B: main is in the top-level directory</a></li><li><a href="#important">Important</a></li></ul></li><li><a href="#step-2-path-names-and-case">Step 2: Path names and case</a><ul><li><a href="#stata">Stata</a></li><li><a href="#r">R</a></li><li><a href="#implementing">Implementing</a></li><li><a href="#expert-tip">Expert tip</a></li></ul></li><li><a href="#step-3-dependencies">Step 3: Dependencies</a><ul><li><a href="#stata-packages">Stata packages</a></li><li><a href="#r-packages">R packages</a></li></ul></li><li><a href="#step-4-displays">Step 4: Displays</a></li><li><a href="#step-5-testing-in-containers">Step 5: Testing in containers</a><ul><li><a href="#authorized-containers">Authorized containers</a></li><li><a href="#steps">Steps</a></li><li><a href="#alternative-approach">Alternative approach</a></li><li><a href="#fallback-run-on-a-different-computer">Fallback: Run on a different computer</a></li><li><a href="#success">Success</a></li></ul></li><li><a href="#finalize-readme">Finalize README</a></li><li><a href="#submitting">Submitting</a></li><li><a href="#problems">Problems?</a></li></ul></li></ul>

            </nav>
          </aside>
        
        

      
        <blockquote>
  <p>The steps in this document are being used in a pilot project.</p>
</blockquote>

<p>This document describes how to prepare your code for verification, taking into account some of the most frequent issues that the Data Editor and his team have encountered in submitted replication packages.</p>

<blockquote>
  <p>⚠️❗ <strong>IMPORTANT:</strong> At this point, you should only be seeing this page if you were asked by the Data Editor team to do so, and if your replication package relies on a single software. Admissible containers are listed in the <a href="#authorized-containers">Step 5 section: authorized containers</a>. We are not currently attempting to generalize this to multi-software replication packages, though <a href="https://github.com/AEADataEditor/docker-r-gurobi">it</a> <a href="https://github.com/AEADataEditor/docker-aer-2022-0276">is</a> <a href="https://github.com/AEADataEditor/docker-aer-2023-0505">possible</a> <a href="https://github.com/AEADataEditor/docker-aer-2023-0700">to do so</a>.</p>
</blockquote>

<h2 id="overview">Overview</h2>

<p>We will describe a few checks and edits you should make to your code, in order to ensure maximum reproducibility. We then describe how to test for reproducibility before submitting to the Data Editor. All steps have been tested by undergraduate replicators, and should be easy to implement. Whether they take a lot of time depends on your specific code, but generally, these adjustments can be made by somebody with good knowledge of the code base very quickly.</p>

<p>Much more extensive guidance on the issues addressed here is available at <a href="https://larsvilhuber.github.io/self-checking-reproducibility/">https://larsvilhuber.github.io/self-checking-reproducibility/</a>. We reference specific chapters there at each of the steps.</p>

<blockquote>
  <p>⚠️❗ <strong>IMPORTANT:</strong> All but the last steps can be done by anybody, no special system requirements required, and independent of your ability to share confidential data. However, the last step may not be possible in an institution that does not allow you to install container software (Docker, OrbStack, etc.), and does not have such technology installed on a Linux cluster. We provide a public website where you can leverage containers for verification, but you should not use it for confidential data. In that case, please do all the other steps.</p>
</blockquote>

<div style="page-break-after: always;"></div>

<h2 id="checklist">Checklist</h2>

<p>Print off (as PDF or on paper) the following checklist, and tick off each item as you complete it. Provide the completed checklist as part of the replication package.</p>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><a href="#step-1-main-file"><strong>Step 1: Main file</strong></a>: A single main file is provided that runs all code.</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><a href="#step-2-path-names-and-case"><strong>Step 2: Path names</strong></a>: All paths in code use <code class="language-plaintext highlighter-rouge">/</code> (forward slashes) relative to a single top-level project directory (<code class="language-plaintext highlighter-rouge">$rootdir</code>, <code class="language-plaintext highlighter-rouge">$basedir</code>, etc.). The top-level project directory is set dynamically, not hard-coded (explanations below).</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><a href="#step-3-dependencies"><strong>Step 3: Dependencies</strong></a>: All packages/libraries/dependencies are installed via code once.
    <ul class="task-list">
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />For Stata, these packages are installed into a subdirectory in the project (<code class="language-plaintext highlighter-rouge">$rootdir/ado</code>, <code class="language-plaintext highlighter-rouge">$basedir/adofiles</code>, etc.), and used by the code.</li>
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />For R, <code class="language-plaintext highlighter-rouge">renv</code> is used (exceptions made for other package management systems if such a system is explained).</li>
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />For Python, environments are used (native <code class="language-plaintext highlighter-rouge">venv</code> or <code class="language-plaintext highlighter-rouge">conda</code>), and the necessary top-level requirements specified (no OS-specific dependencies are included).</li>
    </ul>
  </li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><a href="#step-4-displays"><strong>Step 4: Displays</strong></a>: All figures and tables are written out to clearly identified external files, and the authors’ versions, as used in the manuscript, are provided.</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><a href="#step-5-testing-in-containers"><strong>Step 5: Testing in containers</strong></a>: After all changes were made, the code was run
    <ul class="task-list">
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />using an appropriate <strong>authorized</strong> container, and the generated log files are provided.</li>
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />using the provided website, a certified ZIP file was created, and is provided instead of the original replication package.</li>
    </ul>
  </li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />(usually not necessary) <a href="#finalize-readme"><strong>Finalize</strong></a>: Update the README with the necessary information about computer specifications, Docker image used, memory and disk space requirements, and expected runtime.</li>
</ul>

<hr />
<div style="page-break-after: always;"></div>

<h2 id="detailed-instructions">Detailed instructions</h2>

<h3 id="preliminary-directory-structure-of-a-replication-package">Preliminary: Directory structure of a replication package</h3>

<p>A generic replication package, housed at <code class="language-plaintext highlighter-rouge">/my/computer/users/me/project</code>, might have the following structure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>README.pdf
data/
   raw/
      cps0001.dat
   analysis/
      combined_data.dta
      combined_data.csv
      combined_data_codebook.pdf
code/
  01_readcps.do
  02_readfred.do
  03_table1-5.do
  04_figures1-4.do
results/
  table1.tex
  table2.xlsx
  ...
  figure1.png
  figure2.pdf
</code></pre></div></div>

<p>where</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">data/raw</code> has the externally acquired raw data files (not modified by the authors)</li>
  <li><code class="language-plaintext highlighter-rouge">data/analysis</code> has the processed data files, generated by the code in this repository.</li>
  <li><code class="language-plaintext highlighter-rouge">code</code> has the code files.</li>
  <li><code class="language-plaintext highlighter-rouge">results</code> has all the results files.</li>
</ul>

<p>For illustration purposes, we have used Stata <code class="language-plaintext highlighter-rouge">.do</code> files, and outputs in a variety of formats, but the same principles apply to other software, and to any output formats.</p>

<blockquote>
  <p>Note that we did not specify where the <code class="language-plaintext highlighter-rouge">main.do</code> file will be!</p>
</blockquote>

<h3 id="short-cut">Short-cut</h3>

<blockquote>
  <p>If you want to include the key code pieces for Stata that are needed to comply with Steps 1-3, you can use  <a href="https://gist.github.com/larsvilhuber/d8b643a408d425ef2a80385b6377870d">this code fragment</a>. Note that you do not HAVE to use this specific code, if your code already has equivalent features!</p>
</blockquote>

<h3 id="step-1-main-file">Step 1: Main file</h3>

<blockquote>
  <p>You may or may not have a main file. The following should be adapted to your circumstances. You do not need to create a file that is called <code class="language-plaintext highlighter-rouge">main.do</code> if you already have one, but you may need to update your existing main file.</p>
</blockquote>

<blockquote>
  <p>Reference: <a href="https://larsvilhuber.github.io/self-checking-reproducibility/02-hands_off_running.html">https://larsvilhuber.github.io/self-checking-reproducibility/02-hands_off_running.html</a></p>
</blockquote>

<p>Creating a single main file is straightforward. However, you will want to make some minor edits depending on where, in the above template setup, the file is located:</p>

<h4 id="scenario-a-main-is-in-the-code-directory">Scenario A: <code class="language-plaintext highlighter-rouge">main</code> is in the <code class="language-plaintext highlighter-rouge">code</code> directory</h4>

<p>The most frequent scenario we see (which we call <strong>Scenario A</strong>) amongst economists is that the main file is in the <code class="language-plaintext highlighter-rouge">code</code> directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>README.pdf
data/
...
code/
  main.do
  01_readcps.do
  02_readfred.do
...
</code></pre></div></div>

<p>In this case, the following generic main file will work, with <code class="language-plaintext highlighter-rouge">scenario</code> set to <code class="language-plaintext highlighter-rouge">"A"</code>.</p>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">local</span><span class="w"> </span><span class="n">scenario</span><span class="w"> </span><span class="s2">"A"</span><span class="w">          </span><span class="c1">// Scenario A: main is in code directory</span>
<span class="kt">local</span><span class="w"> </span><span class="n">pwd</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">pwd</span><span class="w">                     </span><span class="c1">// This always captures the current directory</span>

<span class="kr">if</span><span class="w"> </span><span class="s2">"`scenario'"</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"A"</span><span class="w"> </span><span class="p">{</span><span class="w">             </span><span class="c1">// If in Scenario A, we need to change directory first</span>
<span class="k">    cd</span><span class="w"> </span><span class="o">..</span>
<span class="p">}</span>
<span class="kt">global</span><span class="w"> </span><span class="n">rootdir</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">pwd</span><span class="w">                </span><span class="c1">// Now capture the directory to use as rootdir</span>
<span class="k">display</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="s2">"Rootdir has been set to: $rootdir"</span>
<span class="k">cd</span><span class="w"> </span><span class="s2">"`pwd'"</span><span class="w">                            </span><span class="c1">// Return to where we were before and never again use cd</span>

<span class="c1">// Now run the rest of the code</span>
<span class="k">do</span><span class="w"> </span><span class="s2">"$rootdir/code/01_readcps.do"</span>
<span class="k">do</span><span class="w"> </span><span class="s2">"$rootdir/code/02_readfred.do"</span>
<span class="k">do</span><span class="w"> </span><span class="s2">"$rootdir/code/03_table1-5.do"</span>
<span class="k">do</span><span class="w"> </span><span class="s2">"$rootdir/code/04_figures1-4.do"</span>
</code></pre></div></div>

<h4 id="scenario-b-main-is-in-the-top-level-directory">Scenario B: <code class="language-plaintext highlighter-rouge">main</code> is in the top-level directory</h4>

<p>More common in other computational sciences, but also present amongst economists, is that the main file is in the top-level directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>README.pdf
main.do
data/
...
code/
  01_readcps.do
  02_readfred.do
...
</code></pre></div></div>

<p>In this case, the following generic main file will work, with <code class="language-plaintext highlighter-rouge">scenario</code> set to <code class="language-plaintext highlighter-rouge">"B"</code>(though see <a href="#step-3-dependencies">Step 3 Dependencies</a>)</p>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">local</span><span class="w"> </span><span class="n">scenario</span><span class="w"> </span><span class="s2">"B"</span><span class="w">          </span><span class="c1">// Scenario B: main is in project top-level directory</span>
<span class="kt">local</span><span class="w"> </span><span class="n">pwd</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">pwd</span><span class="w">                     </span><span class="c1">// This always captures the current directory</span>

<span class="kr">if</span><span class="w"> </span><span class="s2">"`scenario'"</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"A"</span><span class="w"> </span><span class="p">{</span><span class="w">             </span><span class="c1">// If in Scenario A, we need to change directory first</span>
<span class="k">    cd</span><span class="w"> </span><span class="o">..</span>
<span class="p">}</span>
<span class="kt">global</span><span class="w"> </span><span class="n">rootdir</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">pwd</span><span class="w">                </span><span class="c1">// Now capture the directory to use as rootdir</span>
<span class="k">display</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="s2">"Rootdir has been set to: $rootdir"</span>
<span class="k">cd</span><span class="w"> </span><span class="s2">"`pwd'"</span><span class="w">                            </span><span class="c1">// Return to where we were before and never again use cd</span>

<span class="c1">// Now run the rest of the code</span>
<span class="k">do</span><span class="w"> </span><span class="s2">"$rootdir/code/01_readcps.do"</span>
<span class="k">do</span><span class="w"> </span><span class="s2">"$rootdir/code/02_readfred.do"</span>
<span class="k">do</span><span class="w"> </span><span class="s2">"$rootdir/code/03_table1-5.do"</span>
<span class="k">do</span><span class="w"> </span><span class="s2">"$rootdir/code/04_figures1-4.do"</span>
</code></pre></div></div>

<h4 id="important">Important</h4>

<blockquote>
  <p>In neither scenario did we hard-code the path to our project directory <code class="language-plaintext highlighter-rouge">/my/computer/users/me/project</code>. This is not an omission, and it is important, because it allows the code to be run on any computer, without modification.</p>
</blockquote>

<p>Finally, you should not hard-code your <code class="language-plaintext highlighter-rouge">rootdir</code>. Set the <strong>project root directory dynamically</strong>:</p>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">global</span><span class="w"> </span><span class="n">rootdir</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">pwd</span><span class="w">   </span>
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># if using the here package:</span><span class="w">
</span><span class="n">rootdir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">here</span><span class="o">::</span><span class="n">here</span><span class="p">()</span><span class="w">
</span><span class="c1"># or the rprojroot package</span><span class="w">
</span><span class="n">rootdir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rprojroot</span><span class="o">::</span><span class="n">find_root_file</span><span class="p">(</span><span class="s2">"README.pdf"</span><span class="p">)</span><span class="w">  </span><span class="c1"># or other marker file</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>IMPORTANT: your code MUST contain the line (Stata) <code class="language-plaintext highlighter-rouge">global rootdir : pwd</code> (or equivalent) to set the project root directory dynamically.</p>
</blockquote>

<h3 id="step-2-path-names-and-case">Step 2: Path names and case</h3>

<p>Two issues:</p>

<ul>
  <li>
    <p>Windows computers use <code class="language-plaintext highlighter-rouge">\</code> (backslashes) in path names, while Mac and Linux computers use <code class="language-plaintext highlighter-rouge">/</code> (forward slashes). The use of <code class="language-plaintext highlighter-rouge">\</code> (backslashes) in path names breaks code on Mac and Linux computers.</p>
  </li>
  <li>
    <p>Windows and Mac computers use case-insensitive file systems, while Linux computers use case-sensitive file systems.</p>
  </li>
</ul>

<p>Both of these issues need to be addressed. You are helped by a straightforward but often forgotten (or unknown) observation:</p>

<ul>
  <li><strong>Every statistical programming language can use generic path names using <code class="language-plaintext highlighter-rouge">/</code> (forward slashes).</strong> This ensures wide reproducibility.</li>
</ul>

<p>About 40% of replication packages in economics appear to be submitted by researchers using computers running MacOS or Linux. With a bit of simplified math, if we believe that is representative of what future replicators will do, that means that 40% of users will not be able to run 60% of replication packages without some potentially widespread edits, because of those backslashes.</p>

<p>You should thus <strong>replace all path names in your code to use <code class="language-plaintext highlighter-rouge">/</code> (forward slashes)</strong>, or appropriate functions, and take care to write <strong>case-sensitive file and path names</strong>. This is straightforward:</p>

<h4 id="stata">Stata</h4>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Instead of</span>
<span class="k">use</span><span class="w"> </span><span class="s2">"data\analysis\combined_data.dta"</span><span class="p">,</span><span class="w"> </span><span class="n">clear</span>
<span class="c1">// Use</span>
<span class="k">use</span><span class="w"> </span><span class="s2">"data/analysis/combined_data.dta"</span><span class="p">,</span><span class="w"> </span><span class="n">clear</span>
<span class="c1">// or better</span>
<span class="k">use</span><span class="w"> </span><span class="s2">"$rootdir/data/analysis/combined_data.dta"</span><span class="p">,</span><span class="w"> </span><span class="n">clear</span>
</code></pre></div></div>

<h4 id="r">R</h4>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Instead of</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data\\analysis\\combined_data.csv"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Use</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/analysis/combined_data.csv"</span><span class="p">)</span><span class="w">
</span><span class="c1"># or better</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span><span class="w"> </span><span class="s2">"data"</span><span class="p">,</span><span class="w"> </span><span class="s2">"analysis"</span><span class="p">,</span><span class="w"> </span><span class="s2">"combined_data.csv"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>and similarly for other languages.</p>

<h4 id="implementing">Implementing</h4>

<p>In many cases, you can just globally replace all <code class="language-plaintext highlighter-rouge">\</code> with <code class="language-plaintext highlighter-rouge">/</code> in your code files. Caution however is warranted if your code explicitly writes out $LaTeX$ code, which also (legitimately) uses <code class="language-plaintext highlighter-rouge">\</code>. In that case, you will need to be more careful.</p>

<h4 id="expert-tip">Expert tip</h4>

<p>If using a (Bash or Zsh) terminal, you likely have the <code class="language-plaintext highlighter-rouge">sed</code> command available. You can use it to replace all backslashes with forward slashes in all <code class="language-plaintext highlighter-rouge">.do</code> files in the <code class="language-plaintext highlighter-rouge">code</code> directory as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s+\\+/+g'</span> code/<span class="k">*</span>.do
</code></pre></div></div>

<h3 id="step-3-dependencies">Step 3: Dependencies</h3>

<h4 id="stata-packages">Stata packages</h4>

<p>Stata users frequently use user-written packages, which are made available to the Stata community via the <a href="https://www.stata-journal.com/">Stata Journal</a>, <a href="https://ideas.repec.org/s/boc/bocode.html">SSC</a>, or Github. They are typically installed using a small number of variants of the <code class="language-plaintext highlighter-rouge">net install</code> command (including <code class="language-plaintext highlighter-rouge">ssc install</code>).</p>

<p>Replicators need to have the same versions of these packages installed. Stata does not (currently) provide a way to install older versions of packages, and a regular occurrence of reproducibility failure is due to changes in packages over time. We have some simple solutions to this problem.</p>

<p>First, use an environment to permanently install-project specific packages once and for all.</p>

<p><strong>Define the environment</strong> in your main file, after setting <code class="language-plaintext highlighter-rouge">$rootdir</code>:</p>

<blockquote>
  <p>Reference: <a href="https://larsvilhuber.github.io/self-checking-reproducibility/12-environments-in-stata.html">https://larsvilhuber.github.io/self-checking-reproducibility/12-environments-in-stata.html</a> and <a href="https://github.com/AEADataEditor/replication-template/blob/master/template-config.do#L129">https://github.com/AEADataEditor/replication-template/blob/master/template-config.do#L129</a>.</p>
</blockquote>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* install any packages locally */</span>
<span class="k">di</span><span class="w"> </span><span class="s2">"=== Redirecting where Stata searches for ado files ==="</span>
<span class="k">capture</span><span class="w"> </span><span class="n">mkdir</span><span class="w"> </span><span class="s2">"$rootdir/ado"</span>
<span class="k">adopath</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PERSONAL</span>
<span class="k">adopath</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">OLDPLACE</span>
<span class="k">adopath</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SITE</span>
<span class="k">sysdir</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">PLUS</span><span class="w">     </span><span class="s2">"$rootdir/ado/plus"</span>
<span class="k">sysdir</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">PERSONAL</span><span class="w"> </span><span class="s2">"$rootdir/ado"</span><span class="w">       </span><span class="c1">// may be needed for some packages</span>
<span class="k">sysdir</span>
</code></pre></div></div>

<p>From this point on, all installed packages will be installed into <code class="language-plaintext highlighter-rouge">$rootdir/ado</code>, and Stata will look there first when loading packages.</p>

<p><strong>Install packages once</strong> if not present, but don’t reinstall if already present.</p>

<blockquote>
  <p>Reference: <a href="https://gist.github.com/larsvilhuber/d8b643a408d425ef2a80385b6377870d#file-part2_of_main-do-L14">https://gist.github.com/larsvilhuber/d8b643a408d425ef2a80385b6377870d#file-part2_of_main-do-L14</a>, though you should be able to just use your own install code as well, if it worked before.</p>
</blockquote>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">*** Add required packages from SSC to this list ***</span>
<span class="kt">local</span><span class="w"> </span><span class="n">ssc_packages</span><span class="w"> </span><span class="s2">""</span>
<span class="w">    </span><span class="c1">// Example:</span>
<span class="w">    </span><span class="c1">// local ssc_packages "estout boottest"</span>
<span class="w">    </span><span class="c1">// </span>
<span class="k">    display</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="s2">"============ Installing packages/commands from SSC ============="</span>
<span class="k">    display</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="s2">"== Packages: `ssc_packages'"</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">!</span><span class="nf">missing</span><span class="p">(</span><span class="s2">"`ssc_packages'"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">foreach</span><span class="w"> </span><span class="n">pkg</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="s2">`ssc_packages'</span><span class="w"> </span><span class="p">{</span>
<span class="k">            capture</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="s2">`pkg'</span>
<span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="n">_rc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">111</span><span class="w"> </span><span class="p">{</span><span class="w">                 </span>
<span class="k">               dis</span><span class="w"> </span><span class="s2">"Installing `pkg'"</span>
<span class="k">                ssc</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="s2">`pkg'</span>
<span class="w">            </span><span class="p">}</span>
<span class="k">            which</span><span class="w"> </span><span class="s2">`pkg'</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">ado</span>
</code></pre></div></div>

<p><strong>Some special cases</strong> (usually not necessary)</p>

<p><em>For some packages, the package name is not the same thing as the command name.</em> Example: <code class="language-plaintext highlighter-rouge">moremata</code>. For these packages, the above code does not work. Use this code:<sup id="fnref:unconditional-packages"><a href="#fn:unconditional-packages" class="footnote" rel="footnote" role="doc-noteref">1</a></sup></p>

<blockquote>
  <p>Reference: <a href="https://gist.github.com/larsvilhuber/d8b643a408d425ef2a80385b6377870d#file-part2_of_main-do-L27">https://gist.github.com/larsvilhuber/d8b643a408d425ef2a80385b6377870d#file-part2_of_main-do-L27</a></p>
</blockquote>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="c1">// If you have packages that need to be unconditionally installed (the name of the package differs from the included commands), then list them here.</span>
<span class="w">    </span><span class="c1">// examples are moremata, egennmore, blindschemes, etc.</span>
<span class="kt">local</span><span class="w"> </span><span class="n">ssc_unconditional</span><span class="w"> </span><span class="s2">""</span>
<span class="cm">/* add unconditionally installed packages */</span>
<span class="k">    display</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="s2">"=============== Unconditionally installed packages from SSC ==============="</span>
<span class="k">    display</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="s2">"== Packages: `ssc_unconditional'"</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">!</span><span class="nf">missing</span><span class="p">(</span><span class="s2">"`ssc_unconditional'"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">foreach</span><span class="w"> </span><span class="n">pkg</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="s2">`ssc_unconditional'</span><span class="w"> </span><span class="p">{</span>
<span class="k">            dis</span><span class="w"> </span><span class="s2">"Installing `pkg'"</span>
<span class="k">            cap</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="s2">`pkg'</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">ado</span>
</code></pre></div></div>

<p><em>Packages that are not on SSC may need to be <code class="language-plaintext highlighter-rouge">net install</code>ed from other sources,</em> including Github and personal websites. Again, this does not neatly work with a specific command check, and thus you may need to unconditionally install them. Use this code:</p>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="c1">// If you have packages that need to be unconditionally installed from other sources (not SSC), then list them here.</span>
<span class="w">    </span><span class="c1">// Example: grc1leg</span>
<span class="k">  net</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">grc1leg</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">(</span><span class="s2">"http://www.stata.com/users/vwiggins/"</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Example when net install is not an option </span>
<span class="k">  cap</span><span class="w"> </span><span class="n">mkdir</span><span class="w"> </span><span class="s2">"$rootdir/ado/plus/e"</span>
<span class="k">  cap</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">http</span><span class="o">:</span><span class="c1">//www.sacarny.com/wp-content/uploads/2015/08/ebayes.ado "$rootdir/ado/plus/e/ebayes.ado"</span>
<span class="k">ado</span>
</code></pre></div></div>

<p><strong><em>Adding to replication package</em></strong></p>

<p>The following files should be included in your replication package:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>code/ado/<span class="k">*</span>
</code></pre></div></div>

<h4 id="r-packages">R packages</h4>

<p>For R packages, we suggest that users use <code class="language-plaintext highlighter-rouge">renv</code>, and do not set a specific CRAN mirror. We refer users to the <a href="https://rstudio.github.io/renv/articles/renv.html">renv documentation</a> for details, but in a nutshell, for an existing R project that is not using <code class="language-plaintext highlighter-rouge">renv</code>, the following commands should be run in the R console:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"renv"</span><span class="p">)</span><span class="w">  </span><span class="c1"># only once</span><span class="w">
</span><span class="n">renv</span><span class="o">::</span><span class="n">init</span><span class="p">()</span><span class="w">               </span><span class="c1"># only once per project</span><span class="w">
</span><span class="n">renv</span><span class="o">::</span><span class="n">snapshot</span><span class="p">()</span><span class="w">           </span><span class="c1"># only once per project, after all packages are installed. You should choose to install all packages detected, then snapshotting.</span><span class="w">
</span><span class="n">renv</span><span class="o">::</span><span class="n">status</span><span class="p">()</span><span class="w">             </span><span class="c1"># to check status</span><span class="w">
</span></code></pre></div></div>

<p>This will create a file <code class="language-plaintext highlighter-rouge">renv.lock</code> in the top-level directory of your project.</p>

<p><strong><em>Adding to replication package</em></strong></p>

<p>The following files should be included in your replication package:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.Rprofile
renv.lock
renv/activate.R
renv/settings.json
</code></pre></div></div>

<p>Do not include the entire <code class="language-plaintext highlighter-rouge">renv</code> directory, in particular not the <code class="language-plaintext highlighter-rouge">renv/library</code> subdirectory, as it is platform-specific (of no use to other platforms), and can be very large.</p>

<h3 id="step-4-displays">Step 4: Displays</h3>

<p>Displays (figures and tables) should be written out to external files, and the authors’ versions, as used in the manuscript, should be provided. In the prototypical replication package structure above, these files would be in the <code class="language-plaintext highlighter-rouge">results</code> directory.</p>

<blockquote>
  <p>Reference: <a href="https://larsvilhuber.github.io/self-checking-reproducibility/03-automatically_saving_figures.html">https://larsvilhuber.github.io/self-checking-reproducibility/03-automatically_saving_figures.html</a> and <a href="https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures">https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures</a></p>
</blockquote>

<p><strong>Figures</strong></p>

<ul>
  <li>All figures can be written out to files. Journals like <code class="language-plaintext highlighter-rouge">pdf</code> and <code class="language-plaintext highlighter-rouge">eps</code> files, but <code class="language-plaintext highlighter-rouge">png</code> are convenient. You can output multiple formats.</li>
  <li>Whenever you have displayed a figure, also <code class="language-plaintext highlighter-rouge">export</code>it to a file. It’s a simple command.</li>
</ul>

<p><em>Stata</em></p>

<div class="language-stata highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example for PNG</span>
<span class="k">graph</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="s2">"$rootdir/results/figure1.png"</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="n">width</span><span class="p">(</span><span class="m">1200</span><span class="p">)</span><span class="w"> </span><span class="n">height</span><span class="p">(</span><span class="m">800</span><span class="p">)</span><span class="w"> </span>
<span class="c1">// Example for PDF</span>
<span class="k">graph</span><span class="w"> </span><span class="n">export</span><span class="w"> </span><span class="s2">"$rootdir/results/figure1.pdf"</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span>
</code></pre></div></div>

<p><em>R</em></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Example for PNG if using standard R</span><span class="w">
</span><span class="n">png</span><span class="p">(</span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span><span class="w"> </span><span class="s2">"results"</span><span class="p">,</span><span class="w"> </span><span class="s2">"figure1.png"</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1200</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">800</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">  </span><span class="c1"># your plotting code here</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w"> 
</span><span class="c1"># Example if using ggplot2</span><span class="w">
</span><span class="n">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span><span class="w"> </span><span class="s2">"results"</span><span class="p">,</span><span class="w"> </span><span class="s2">"figure1.png"</span><span class="p">),</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myplot</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><em>More complex figures</em></p>

<p>For more complex figures, it may be easier to simply write out the data underlying the figure to an Excel sheet, and create the figure there. See <a href="https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures#arbitrary-data-to-excel">https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures#arbitrary-data-to-excel</a>  on how to write out the underlying data. <strong>You would then include the Excel file that maps the data into a figure with your replication package.</strong></p>

<p><strong>Tables</strong></p>

<p>Tables may be more complex. Simple tables can be written out using various tools:</p>

<p><em>Stata</em></p>

<p><code class="language-plaintext highlighter-rouge">esttab</code> or <code class="language-plaintext highlighter-rouge">outreg2</code>, also <code class="language-plaintext highlighter-rouge">putexcel</code>. For fancier stuff, treat tables as data, use <code class="language-plaintext highlighter-rouge">regsave</code> or <code class="language-plaintext highlighter-rouge">export excel</code> to manipulate.</p>

<p><em>R</em></p>

<p><code class="language-plaintext highlighter-rouge">xtable</code>, <code class="language-plaintext highlighter-rouge">stargazer</code>, others.</p>

<p><em>More complex tables</em></p>

<p>For more complex tables, it may be easier to simply write out entire matrices, or individual numbers, to an Excel sheet, and compose the table there. See <a href="https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures#examples">https://github.com/labordynamicsinstitute/replicability-training/wiki/How-to-output-tables-and-figures#examples</a> for an example, especially if you have already been compiling your tables in Excel. <strong>You would then include the Excel file that maps the data into your preferred table layout with your replication package.</strong></p>

<h3 id="step-5-testing-in-containers">Step 5: Testing in containers</h3>

<p>After you have made all the above changes, you should test your code in an appropriate <strong>authorized</strong> container.</p>

<blockquote>
  <p>⚠️❗ <strong>IMPORTANT:</strong> If you do not have Docker installed on your computer, do not have the rights to install Docker on your computer, or do not have access otherwise to Docker, please do not attempt this, and skip straight <a href="#alternative-approach-no-docker">to the alternative approach</a>.</p>
</blockquote>

<blockquote>
  <p>Reference: <a href="https://larsvilhuber.github.io/self-checking-reproducibility/80-docker.html">https://larsvilhuber.github.io/self-checking-reproducibility/80-docker.html</a></p>
</blockquote>

<h4 id="authorized-containers">Authorized containers</h4>

<p>The following list of containers are authorized for testing, as they are reliably available, and achieve the desired transparency.</p>

<ul>
  <li>Stata containers for versions 19now back to 11, provided by the Social Science Data Editors at <a href="https://hub.docker.com/u/dataeditors">https://hub.docker.com/u/dataeditors</a>, such as <code class="language-plaintext highlighter-rouge">dataeditors/stata18_5-mp:2025-02-26</code>. (requires a license)</li>
  <li>R containers provided by the <a href="https://www.rocker-project.org/">Rocker Project</a>, such as <code class="language-plaintext highlighter-rouge">rocker/r-ver:4.3.1</code> or <code class="language-plaintext highlighter-rouge">rocker/tidyverse:4.3.1</code> (which includes the <code class="language-plaintext highlighter-rouge">tidyverse</code> packages).</li>
  <li>MATLAB + Dynare containers provided by the <a href="https://www.dynare.org/new-dynare-release/dynare-docker-released/">Dynare Project</a> at <a href="https://hub.docker.com/r/dynare/dynare">https://hub.docker.com/r/dynare/dynare</a>, such as <code class="language-plaintext highlighter-rouge">dynare/dynare:5.3-2024-05-21</code>. See the <a href="https://www.dynare.org/new-dynare-release/dynare-docker-released/">project page</a> for the mapping betweeen containers and MATLAB versions. (requires a MATLAB license)</li>
</ul>

<p>If you know of a different container that we should add to this list, please let us know. The <a href="https://github.com/AEADataEditor/">AEA Data Editor’s Github profile</a> has a few other containers that have worked, but may be too advanced for the typical user.</p>

<blockquote>
  <p>⚠️❗ <strong>IMPORTANT:</strong> Do not provide us with a custom container that is not  on the above list. Transparency requires that the container be built, using a <code class="language-plaintext highlighter-rouge">Dockerfile</code> or <code class="language-plaintext highlighter-rouge">apptainer.def</code> file, from publicly available sources. While we will happily use your container, it must be built from one of the above sources, or well-known “standard” sources, such as “Docker Official Images” in the Dockerhub <code class="language-plaintext highlighter-rouge">library</code> space (e.g., <a href="https://hub.docker.com/_/python">https://hub.docker.com/_/python</a>).</p>
</blockquote>

<h4 id="steps">Steps</h4>

<ul>
  <li>Install the software necessary for running containers.
    <ul>
      <li>For Windows, install <a href="https://docs.docker.com/desktop/install/windows-install/">Docker Desktop for Windows</a>.</li>
      <li>For Mac, install <a href="https://docs.docker.com/desktop/install/mac-install/">Docker Desktop for Mac</a> or <a href="https://orbstack.dev">OrbStack</a>.</li>
      <li>For Linux, install Docker engine,  <a href="https://podman.io/getting-started/installation">Podman</a>, or use <a href="https://apptainer.org/">Apptainer</a>. These can all also be installed on Windows under Windows Subsystem for Linux (WSL).</li>
    </ul>
  </li>
  <li>All example commands below are from a Bash or Zsh terminal, which are standard on Mac and Linux, as well as on Windows if using WSL. If you do not have WSL on Windows and are using the Powershell, the same principles apply, but the syntax may be different.</li>
</ul>

<blockquote>
  <p>When code has been adjusted as in Steps 1-4, no complex adjustment of containers is necessary.</p>
</blockquote>

<ul>
  <li>Run the container, mounting your project directory into the container. For example, if your project is in <code class="language-plaintext highlighter-rouge">/my/computer/users/me/project</code>, you would use a command such as this (example for Stata):</li>
</ul>

<p><strong>Preliminaries</strong></p>

<p>(may need some adjustment, depending on your license)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">VERSION</span><span class="o">=</span>18_5
<span class="nv">TAG</span><span class="o">=</span>2025-02-26
<span class="nv">MYHUBID</span><span class="o">=</span>dataeditors
<span class="nv">MYIMG</span><span class="o">=</span>stata<span class="k">${</span><span class="nv">VERSION</span><span class="k">}</span>
<span class="nv">CONTAINER</span><span class="o">=</span><span class="nv">$MYHUBID</span>/<span class="k">${</span><span class="nv">MYIMG</span><span class="k">}</span>-<span class="k">${</span><span class="nv">TYPE</span><span class="k">}</span>:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span> 
<span class="nv">TYPE</span><span class="o">=</span>mp
<span class="nv">STATALIC</span><span class="o">=</span>/path/to/your/stata/stata.lic
</code></pre></div></div>

<p>Explanations:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">VERSION</code>: This is the Stata version. StataNow is referenced with a <code class="language-plaintext highlighter-rouge">_5</code> suffix, otherwise, this corresponds to your (major) Stata version number.</li>
  <li><code class="language-plaintext highlighter-rouge">TAG</code>: This is the date the container was built, in <code class="language-plaintext highlighter-rouge">YYYY-MM-DD</code> format. Recent Stata containers do not (on purpose) have a <code class="language-plaintext highlighter-rouge">latest</code> tag, but older ones (that are no longer maintained) do, and can replace the date with <code class="language-plaintext highlighter-rouge">latest</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">CONTAINER</code>:  is the fully qualified name of the container to be used. It is built from various components. For Stata images, these are maintained by <code class="language-plaintext highlighter-rouge">dataeditors</code> on Dockerhub. All available Stata containers and tags can be viewed on <a href="https://hub.docker.com/u/dataeditors">https://hub.docker.com/u/dataeditors</a>. The precise way to call the container may depend on the version. For instance, for versions prior to <code class="language-plaintext highlighter-rouge">18</code>, the <code class="language-plaintext highlighter-rouge">-${TYPE}</code> suffix is not used.</li>
  <li><code class="language-plaintext highlighter-rouge">STATALIC</code>: Is the path (in the notation used by the terminal you are using) to your Stata license file <code class="language-plaintext highlighter-rouge">stata.lic</code>. You need to have a valid Stata license file for the version of Stata you are using.</li>
</ul>

<blockquote>
  <p>If you have only an older license, or a non-MP license, you may need to replace <code class="language-plaintext highlighter-rouge">VERSION</code>, <code class="language-plaintext highlighter-rouge">TAG</code>, and <code class="language-plaintext highlighter-rouge">TYPE</code> accordingly. For instance, if you have a Stata 16 SE license, you would set <code class="language-plaintext highlighter-rouge">VERSION=16</code>, <code class="language-plaintext highlighter-rouge">TAG=2023-06-13</code>, and <code class="language-plaintext highlighter-rouge">TYPE=se</code>, and remove <code class="language-plaintext highlighter-rouge">-${TYPE}</code> from the <code class="language-plaintext highlighter-rouge">CONTAINER</code> definition.</p>
</blockquote>

<p><strong>Test the container</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">--volume</span> <span class="k">${</span><span class="nv">STATALIC</span><span class="k">}</span>:/usr/local/stata/stata.lic <span class="se">\</span>
  <span class="nt">--entrypoint</span> stata-<span class="k">${</span><span class="nv">TYPE</span><span class="k">}</span> <span class="se">\</span>
  <span class="k">${</span><span class="nv">CONTAINER</span><span class="k">}</span>
</code></pre></div></div>

<p>You should see the usual Stata prompt. Type <code class="language-plaintext highlighter-rouge">exit</code> to leave Stata.</p>

<p><strong>Run the container</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">--volume</span> <span class="k">${</span><span class="nv">STATALIC</span><span class="k">}</span>:/usr/local/stata/stata.lic <span class="se">\</span>
  <span class="nt">--volume</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/project <span class="se">\</span>
  <span class="nt">--workdir</span> /project <span class="se">\</span>
  <span class="nt">--entrypoint</span> stata-<span class="k">${</span><span class="nv">TYPE</span><span class="k">}</span> <span class="se">\</span>
  <span class="k">${</span><span class="nv">CONTAINER</span><span class="k">}</span> <span class="nt">-b</span> main.do
</code></pre></div></div>

<p>if using a <strong>Scenario B</strong> setup. If using a <strong>Scenario A</strong> setup, use</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">--volume</span> <span class="k">${</span><span class="nv">STATALIC</span><span class="k">}</span>:/usr/local/stata/stata.lic <span class="se">\</span>
  <span class="nt">--volume</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/project <span class="se">\</span>
  <span class="nt">--workdir</span> /project/code <span class="se">\</span>
  <span class="nt">--entrypoint</span> stata-<span class="k">${</span><span class="nv">TYPE</span><span class="k">}</span> <span class="se">\</span>
  <span class="k">${</span><span class="nv">CONTAINER</span><span class="k">}</span> <span class="nt">-b</span> main.do
</code></pre></div></div>

<h4 id="alternative-approach">Alternative approach</h4>

<p>If you cannot run Docker on your computer, we make available the <a href="https://sivacor.org">SIVACOR</a> service, which allows you to run your code using authorized containers without the need to install software on your own computer, producing a Trusted Research Object (TRO).</p>

<blockquote>
  <p>In fact, we will run your code using this same system to verify compliance with all of the above steps!</p>
</blockquote>

<p><a href="https://sivacor.org"><img src="/images/sivacor-login.png" alt="SIVACOR landing page" /></a></p>

<p>For more information on how to use SIVACOR, see <a href="https://docs.sivacor.org/">https://docs.sivacor.org/</a>. Once you have successfully run your code on SIVACOR, provide the generated certified ZIP file  instead of the original replication package to the Data Editor. A TRO does not need to be re-run by the Data Editor.</p>

<h4 id="fallback-run-on-a-different-computer">Fallback: Run on a different computer</h4>

<p>If you do not have, or cannot, install Docker, and you cannot use SIVACOR, use this alternative approach to test your code:</p>

<ul>
  <li>Download your entire replication package from the draft openICPSR deposit, onto a <strong>different computer</strong> where you have not previously run the code.</li>
  <li>Run the code from that new location.
    <ul>
      <li>For Stata, close all Stata windows, and then double-click on the <code class="language-plaintext highlighter-rouge">main.do</code> file. This should generate a <code class="language-plaintext highlighter-rouge">main.log</code> file in the same directory as <code class="language-plaintext highlighter-rouge">main.do</code>.
        <ul>
          <li>For R, from a terminal or the RStudio <strong>Terminal</strong> tab, type <code class="language-plaintext highlighter-rouge">R CMD BATCH main.R</code>, or if using <code class="language-plaintext highlighter-rouge">renv</code>, <code class="language-plaintext highlighter-rouge">R --no-save --no-restore -f main.R &gt; main.Rout</code>.<sup id="fnref:noteshell"><a href="#fn:noteshell" class="footnote" rel="footnote" role="doc-noteref">2</a></sup>  This should generate a <code class="language-plaintext highlighter-rouge">main.Rout</code> file in the same directory as <code class="language-plaintext highlighter-rouge">main.R</code>.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>We note that in our experience, this approach is much less reliable.</p>

<h4 id="success">Success</h4>

<p>If your code does run into problems, the generated <code class="language-plaintext highlighter-rouge">main.log</code> or <code class="language-plaintext highlighter-rouge">main.Rout</code> should have clues as to what went wrong. You should be able to fix these issues, and re-run the code in the container, until it runs without error.</p>

<p>If your code runs without error, and produces all expected output files, you are done!</p>

<h3 id="finalize-readme">Finalize README</h3>

<blockquote>
  <p>Reference: <a href="https://social-science-data-editors.github.io/template_README/template-README.html">https://social-science-data-editors.github.io/template_README/template-README.html</a></p>
</blockquote>

<p>This step is usually not necessary, but you want to just make sure that your README has the necessary information that help set expectations about computational feasibility, based on the steps above.</p>

<ul>
  <li><a href="https://social-science-data-editors.github.io/template_README/template-README.html#software-requirements"><strong>Software</strong>:</a> If you used a container, specify which container you used (name and tag, e.g., <code class="language-plaintext highlighter-rouge">dataeditors/stata18_5-mp:2025-02-26</code>). Be precise when describing the StataMP version - the number of cores matters! (<code class="language-plaintext highlighter-rouge">StataMP-4</code> may not behave the same way as <code class="language-plaintext highlighter-rouge">StataMP-8</code>.)</li>
  <li><a href="https://social-science-data-editors.github.io/template_README/template-README.html#memory-runtime-storage-requirements"><strong>Hardware</strong>:</a> Verify that the description of your computer (CPU, number of cores, RAM, disk space) is accurate.</li>
  <li><a href="https://social-science-data-editors.github.io/template_README/template-README.html#memory-runtime-storage-requirements"><strong>Run time</strong>:</a> Provide an estimate of the expected run time, however trivial it might be. It matters to the replicator!</li>
</ul>

<p><strong>Examples:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- OS: "openSUSE Leap 15.6"
- Processor:  13th Gen Intel(R) Core(TM) i7-1365U, 12 cores
- Memory available: 30GB memory
- Docker version 28.4.0-ce, build 249d679a6 
- stata version 18-mp-i (Docker image dataeditors/stata18-mp-i:2024-12-18) (born date: "18 Dec 2024") with 32 core license

Code ran for about 35 hours.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- OS: Windows Server AMD EPYC 7763 64-Core Processor 2.44 GHz, 128GB
- Stata/MP4 19.5 ("21 May 2025")
- MATLAB R2025a

Code runs about 10 minutes for Stata portion, and about 5 days for MATLAB portion.
</code></pre></div></div>

<h3 id="submitting">Submitting</h3>

<p>You can now submit your replication package to the Data Editor, along with the completed checklist from above, and the generated <code class="language-plaintext highlighter-rouge">main.log</code>/<code class="language-plaintext highlighter-rouge">main.Rout</code> as evidence.</p>

<h3 id="problems">Problems?</h3>

<p>If you run into problems in Step 5, no worries, simply submit all the files as modified in Steps 1-4, along with the completed checklist, and we will handle the remaining issues.</p>
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:unconditional-packages">
      <p>A more customized setup might check for a package-specific file in the <code class="language-plaintext highlighter-rouge">ado</code> directory, such as the <code class="language-plaintext highlighter-rouge">&lt;package&gt;.pkg</code>, but this is more complex and may not always work. <a href="#fnref:unconditional-packages" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:noteshell">
      <p>In PowerShell, you can use <code class="language-plaintext highlighter-rouge">R --no-save --no-restore -f main.R | Out-File -Encoding UTF8 main.Rout</code>. <a href="#fnref:noteshell" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

        
      </section>

      <footer class="page__meta">
        
        


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Published:</strong> <time datetime="2025-12-04T00:00:00-05:00">December 4, 2025</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Preparing+your+code+for+computational+verification%20https%3A%2F%2Faeadataeditor.github.io%2Faea-de-guidance%2Fpreparing-replication-package" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Faeadataeditor.github.io%2Faea-de-guidance%2Fpreparing-replication-package" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<div class="page__footer-follow page__footer-custom">
    <ul class="social-icons">
      <li><strong>Suggestions and comments:</strong></li>
             <li><a href="https://github.com/AEADataEditor/aeadataeditor.github.io/blob/main/_guidance/preparing-replication-package.md"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Edit</a></li>
             <li><a href="https://twitter.com/messages/compose?recipient_id=1115329171121680385" data-screen-name="@AEAData">
              <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> @AEAData</a></li>
             <li><a rel="me" href="https://mstdn.social/@aeadata"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i>aeadata@mstdn.social</a></li>
            <li><a href="https://www.aeaweb.org/contact"><i class="fas fa-paper-plane" aria-hidden="true"></i> Email</a></li>

    </ul>
  </div>
  
<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    <!-- 
      <li><strong>Follow:</strong></li>
     -->
    <li><strong><a href="/disclosures.html">Disclosures</a></strong></li>

    
      
        
          <li><a href="https://bsky.app/profile/aeadata.bsky.social" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Bluesky</a></li>
        
      
        
          <li><a href="https://mstdn.social/@aeadata" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i> Mastodon</a></li>
        
      
        
          <li><a href="https://github.com/aeadataeditor" rel="me nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 American Economic Association. 
  <a href="https://github.com/AEADataEditor/aeadataeditor.github.io/blob/main/LICENSE.md">
    
    <img src="/images/ccby80x15.png" width="80px" height="15px" alt="CC BY 4.0" />
    </a>
  
   Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.
</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
